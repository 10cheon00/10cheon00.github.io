{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/24-1-18-spring-security/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"13c6228f-5b21-571e-ba15-c99e15fab814","excerpt":"docker-compose로 mysql과 spring boot 앱을 같이 올려보려고 했는데, mysql은 정상적으로 초기화 되었지만 spring boot 앱이 자꾸 mysql과 연결되지 못해 에러를 내었다. 이 부분은 조금 더 공부해야겠다. mysql…","html":"<p>docker-compose로 mysql과 spring boot 앱을 같이 올려보려고 했는데, mysql은 정상적으로 초기화 되었지만 spring boot 앱이 자꾸 mysql과 연결되지 못해 에러를 내었다. 이 부분은 조금 더 공부해야겠다.</p>\n<blockquote>\n<p>mysql을 컨테이너에 올릴 때 테이블을 만들어야 하거나 데이터를 추가해야할 때 volume을 이용한다고 한다.\n이 부분도 공부해야겠다.</p>\n</blockquote>\n<h1 id=\"spring-security\" style=\"position:relative;\"><a href=\"#spring-security\" aria-label=\"spring security permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Spring Security</h1>\n<p>Spring Security는 여러가지 인증 방법(<em>Authentication</em>)과 허가 방법(<em>Authorization</em>)을 지원한다. 오늘 공부한 것은 Username+Password(Credential) 로그인 방법이다.</p>\n<p>Credential을 갖고 로그인하기 위해서는 서버가 미리 Credential을 기억하고 있어야 하는데, Spring Security는 InMemory, JDBC, LDAP와 같은 방법을 사용할 수 있도록 지원한다.</p>\n<h1 id=\"authentication\" style=\"position:relative;\"><a href=\"#authentication\" aria-label=\"authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Authentication</h1>\n<h2 id=\"filter-chain\" style=\"position:relative;\"><a href=\"#filter-chain\" aria-label=\"filter chain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Filter Chain</h2>\n<p>사용자로부터 요청이 들어오면 그 요청을 받아 처리하기 전에 여러가지 <code class=\"language-text\">Filter</code>를 거치게 된다. 이 <code class=\"language-text\">Filter</code>들은 Chaning 형태로 묶여있어, 어떤 <code class=\"language-text\">Filter</code>가 에러를 발생시키면 다음 <code class=\"language-text\">Filter</code>는 실행되지 않고 에러 핸들링으로 넘어간다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 320px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f11cd26a1a6ea252ff29207589a130a8/72799/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 144.30379746835442%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/f11cd26a1a6ea252ff29207589a130a8/72799/image.png\"\n        srcset=\"/static/f11cd26a1a6ea252ff29207589a130a8/c26ae/image.png 158w,\n/static/f11cd26a1a6ea252ff29207589a130a8/6bdcf/image.png 315w,\n/static/f11cd26a1a6ea252ff29207589a130a8/72799/image.png 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Spring은 미리 구현된 <code class=\"language-text\">Filter</code>를 실행할 뿐만 아니라 다른 모듈이 정의한 <code class=\"language-text\">Filter</code>도 실행할 수 있게 <code class=\"language-text\">DelegatingFilterProxy</code>를 지원한다. 여기에 <code class=\"language-text\">SecurityFilterChain</code>이 담겨 있다. 결국 요청이 들어오면 여러 <code class=\"language-text\">Filter</code>를 거치게 되는데 중간에 <code class=\"language-text\">SecurityFilterChain</code>이 수행되어 인증 및 허가를 따지게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/33576f21b0518fad68261ef2bdf36f4f/748f4/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.21518987341771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMElEQVR42mNYvWCj9orkZV82xK78vzpm6b8Jvt3/O71a/y+LXPhvfdyK/6tjl/+fHbrAjIGBgWFV6CpmBkJg8uRZanNr57fNKZ/Tvqh2UdOMkhltE3Mndq5oXFGzpG5J46LKJWXToqYJgtT+Z/jPSNBAKSkFdQY2XlUGTiEZBnZxRXFxPW49V1duZDVpaWmsDMSCmS1Vku/LHVu+lVpM+VJs2b8vSn/2vlj9hd9KrCa8L7aY8rHEaurhLEdtiAsZCLtw3dwpNh86wn78bXH//63Z69+NYof/lwrt/39u8vz3u837/48m938PShyswQbWMzARNLCnp0dk/9EzGof3Hta+d/26+opZ0yy66+ud7ty5o7pz/1GdU6dOKYWGhnL+/w8JPxCNDzOs769X2Beuunq3r8Se7X6S2zf7Su1b5yl58ECQ9PYDgVI7j4fI7D6fYmpAtAu3LJpp9WHj5O8vVvX8f7Ky59/zVT3/X67p+/9ydc+/j1um/f++acL/x93pDiC186ZPV12+ZP7UubOnzlo4Z9qMaZN6Z86cNhGM58ycNHPF0kWzGDbOn279+eGN74/u3Ph/7dzpf7cunf9/5eyp/7cunft348rF/7+e3f1/aVq1C8jACb0TgtesWPJj2pS+H3NmTvk+fXLfj5nTJ4DYP6ZP7vu5YtmizwyLZ82SObJ8lv/ljUuCnuzd7HdyybSoHZM7Ep8c2OR7ccPikJMLJ7t3pIXygwy8f/8+x7Fj56Vfvfoi+eDBK0kQDWO/fv1Vavfuk8IM8+tLJL6WmLf+LNCZ9j1fZ8KBUKXZB8NVFv4u1Jnwo0B78s8ivamXM801QQbWExOGIC+/aA3+/rXB7f/7eo9/lwoc/p/Js/3/ps7936dGz/8f6tz+3i5ytIJESj0TwVgGJ5v1qwy2LltocnLneoNdMzvt5zeXeNw4tE1v24rFpjtXLNIpjonhZvhPRLYDgUW99SpfKm13/ykzPvu50PDE6XiNc4djNC++yjU48afM+NSPEpOzdwqsTIhONvOn91lfa4m9d68u4OmN2oDHh4u8Hx8q9Hp0ucr/8b3GoKd36/zu7c+2J9pAAD+P0+I76WtvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/33576f21b0518fad68261ef2bdf36f4f/f058b/image-1.png\"\n        srcset=\"/static/33576f21b0518fad68261ef2bdf36f4f/c26ae/image-1.png 158w,\n/static/33576f21b0518fad68261ef2bdf36f4f/6bdcf/image-1.png 315w,\n/static/33576f21b0518fad68261ef2bdf36f4f/f058b/image-1.png 630w,\n/static/33576f21b0518fad68261ef2bdf36f4f/748f4/image-1.png 656w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>다수의 <code class=\"language-text\">FilterChain</code>을 걸어 URL패턴에 따라 다르게 수행할 수도 있다고 한다.</p>\n<h2 id=\"basic-login-flow\" style=\"position:relative;\"><a href=\"#basic-login-flow\" aria-label=\"basic login flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Basic Login Flow</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2c6a5729ace39eb48e4b6a4f3792ba45/8802b/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42mNYlLLo3Pyoua97g3oeL4ie+35hzML9DFCwfs2KiXNnTno0c0rfpRmTe69Mn9R7Z+GcaR82rFpxlAEXWDN3jdK6meuUZ/fOVtm5aKfilvlbJGByN27fCz1z60HdmZsPSs7duFd/68Nvt/n//3Ns+v+fi4GBgUkrdBUbDIdCabjBwsLCvHwyMkJaWlpsoaGh/CCxJzcuzfp/ct3/l1vn/H61c+H/15un3f62onHnp60zu0Dy/xkYGDFcWF9fzwSiNTQ0hLW1TWT15fUF3G1tJUFiF7Yu7//XG/r/aqHD750pVv9OFrj8+T858v/PJRX7GdyrJA0ceot17SZUGThOqDB0mlxu5DG9BNlsFhjj//56MPv+ka3db7uj/l8sdftzutTr/4Vyr9+P6rz+f5hXvMckosnQJWDGXju/GUcc/GcedPCbccgpaO4ekD6ws+W1tCQMDc01TTVMhZ2cvKUZGBjYjmxcNeH0pOb/uztrfywqTv+9tbns59EJTf9Pzezaz0AIyMvLC+jq6grKy8tzeHhE84HETh850r95w97/8xZt+TNn9vL/8+Zv+LN89b7/e7buPwD1CzwM////zwjC2L0Mlbh78Yzuo80zIx5vnBR0e83U8GdbZgQ93zgx7Nmhdfa4XAYAIsvjuXnlxvwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/2c6a5729ace39eb48e4b6a4f3792ba45/f058b/image-2.png\"\n        srcset=\"/static/2c6a5729ace39eb48e4b6a4f3792ba45/c26ae/image-2.png 158w,\n/static/2c6a5729ace39eb48e4b6a4f3792ba45/6bdcf/image-2.png 315w,\n/static/2c6a5729ace39eb48e4b6a4f3792ba45/f058b/image-2.png 630w,\n/static/2c6a5729ace39eb48e4b6a4f3792ba45/40601/image-2.png 945w,\n/static/2c6a5729ace39eb48e4b6a4f3792ba45/8802b/image-2.png 1135w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>허가된 사용자만 접근 가능한 자원에 인증되지 않은 사용자가 접근한다면 <code class=\"language-text\">AuthorizationFilter</code>가 이 요청을 거부한다. 곧바로 AccessDeniedException을 일으키게 되고 이 예외는 <code class=\"language-text\">ExceptionTranslationFilter</code>로 전달되어 적절한 응답을 만든다.</p>\n<p><code class=\"language-text\">ExceptionTranslationFilter</code>는 인증되지 않은 사용자가 접근했으므로 인증을 요구하는 <code class=\"language-text\">WWW-Authenticate</code> 헤더가 담긴 응답을 반환한다.</p>\n<p>따라서 사용자는 인증을 받아야 한다는걸 알게 된다. 다시 사용자는 Credential을 담아 로그인 요청을 보낸다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/87dabd92fca3b136b1d72ef66059212a/4971b/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEY0lEQVR42mWSe0xTZxjGP1EQGZcxMxwzU2fo2ABhrsoGMhrnQBaQbVkOWxYEKaS2QFtOL7RW8TjYgLIh1yEthZ5eoKWA3KdcFBDaAiuFtpTLIqIbg4G3jXWTTPAsp+j+mE/yJt+bPN/vffN8Hzjg6+sb7P92kP8b/ofjgoOO0o8SI48Tie8gEOJEiYlxQRDEAezd6wwAcIVRczxVPFacUqYVUsoGvqNWjH6dJhnLZqDWwrPNy6EAFwRBO8BTPeCE0u+xQlqW4SNBeF9Cj9pOoVAcAZHoSCAQgnOaZ4c4SguWVjm4kVpxA6OL9FhapfaxoGkey7v+N/s/ICaKccHmEWfj6XBCPzk0BOuBPLA2iktfKuRKIpG2AQCccK9U0/GKpuv261Su8P2TVH5i2+Cvey7V6gnlcp2PRvPz5mK6i5wPl9gh9xYYxLsDCQEr7XFv3v0p7eDSLwzioxV2SC3uIQHgTBGJHOmKRT+q+n4AtW7h4Gd8ZUwyOhfI7Fh7i/MDFshsfrjPDuwX5X80KvjE1JUeaehIjdQ3pnyg7WZE6XrpUTNW7vG8Z3E0tncTctrmV3mqKYyvsj7hqawYr9aCZSrN6+eb57Gs1iWZ3ZiYiDg/u3Tzq7gjZm40GeuR7bTHgSBO9gwBALGxkB+MlCbA2ZXxzHNFp7h5EqhEoyNVNo6El6u0x/JU+s0NYQjagUB+eEZb7rNCUx5w3qsZIR8+BABwoIUd8Ny7+cKOXl5eu9yA204P4OHpDtxfAgB4AAC2gv8L0mi2Rn9J8wyJiPcKIjFf9Ar4YlcUvWR7LJfsFhEf/wIOAySwDcEwh1gy1y0MSno5LJrmGfEpOYDGz/MUGTBHRNrnjGgmnXCPHeoNgAsAwGu/t/ce3/2vHXo6awt4Xs7uAODbue7bvfvdYB8f9+ccjOLWQKZiJoNzeZFGk5iY6egkTFdM09Olk2wGak7CwVxhy6uCy0tkjmbhFEd9J4GtuX0yXWpJZshnkuk1VjIDnUw612lLoZT0nwDfKm/APHQUY0u0a5ya4TVOtW4NFg0+Yku0GKtmdBgferG294Twym+YQDW9DldpNzJEg09giW6DLRleZ1T0b2RcGvhH2LuKceVmDciVDXzOkxvHeArzUKZ8XMeWGnQ8hWnojGrKyFPNoDiwSD0QLuxamcxqnJvgyo2mTMWEiSszmNhSg4mntJjOqKfG83tXZ9iopRAUKq8nn0X1s3yp3siv0U7wpboJ/CxAh2f58nH7xy6ruxpR2HnHmt04PYYoDcbN+tFeF1Rjxgt1RkNh17KVhxqEQFg/Qc279tdDRrVhgVLcs3i69NoitbRv4Xz78u853avdOLBBpfq4u7XucWtd1Z9V5QU2majYJhMV2cRlQltVmdCmqvn+j75ONSatKCoGBdKrGbltc7cE8hFTan69hZZfb6GXdJi+abt1M6thSokD1eqmgObmJl5DQz0skYhZmyVhicVilkRcyULRavhKRwu3ILcg6l+tnxf+ZVnKWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/87dabd92fca3b136b1d72ef66059212a/f058b/image-3.png\"\n        srcset=\"/static/87dabd92fca3b136b1d72ef66059212a/c26ae/image-3.png 158w,\n/static/87dabd92fca3b136b1d72ef66059212a/6bdcf/image-3.png 315w,\n/static/87dabd92fca3b136b1d72ef66059212a/f058b/image-3.png 630w,\n/static/87dabd92fca3b136b1d72ef66059212a/4971b/image-3.png 784w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 요청은 <code class=\"language-text\">BasicAuthenticationFilter</code>에게 전달되어 Credential이 올바른지 검증을 한다. Credential은 <code class=\"language-text\">UsernamePasswordAuthenticationToken</code>이라는 인스턴스로 추출되어 <code class=\"language-text\">AuthenticationManager</code>에게 전달된다.</p>\n<p><code class=\"language-text\">AuthenticationManager</code>는 주어진 token을 인증하고, 계정이 잠겼다거나, 잘못된 Credential이라거나 하는 오류를 처리한다.</p>\n<p>만약 로그인에 실패했다면, 다시 <code class=\"language-text\">WWW-Authenticate</code> 헤더가 담긴 응답이 반환된다.</p>\n<p>만약 로그인에 성공했다면 연결된 <code class=\"language-text\">Filter</code>들을 호출한다.</p>\n<h2 id=\"authenticationmanager\" style=\"position:relative;\"><a href=\"#authenticationmanager\" aria-label=\"authenticationmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>AuthenticationManager</h2>\n<p>인증을 수행하는 객체인 <code class=\"language-text\">AuthenticationManager</code>는 인터페이스다. 인증 요청이 들어왔을 때 요청을 처리하는 메서드를 갖는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">/**\n\t * @param authentication the authentication request object\n\t * @return a fully authenticated object including credentials\n\t * @throws AuthenticationException if authentication fails\n\t */</span>\n\t<span class=\"token class-name\">Authentication</span> <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AuthenticationException</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"providermanager\" style=\"position:relative;\"><a href=\"#providermanager\" aria-label=\"providermanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>ProviderManager</h2>\n<p><code class=\"language-text\">AuthenticationManager</code> 인터페이스를 구현한 것이 <code class=\"language-text\">ProviderManager</code>다. <code class=\"language-text\">ProviderManager</code>는 내부에 등록된 <code class=\"language-text\">AuthenticationProvider</code> 인스턴스들을 실행하여 인증을 진행한다. 하나라도 통과한다면 인증이 된 것으로 여기고, 그렇지 않았다면 <code class=\"language-text\">ProviderNotFoundException</code>을 발생시킨다. 즉, 인증을 할 수 있는 Provider가 없었다는 것이라고 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/22b75cf155ec667c2040ad5b047ba6ec/cecac/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACB0lEQVR42pVR30tTARS+qcj23kNEcm1osQx600DBHvsH/AuKoJfIlpMsu68VWwWOEhJkKvfuXu+0PQSFxQ3mRutu7c6Zu27o3OyyX3fDuR+6++vEZVq+CPOD7xwOh/PxnXMQ5CwAOKcnk8nci6JXb5lM14Z6eq4Pd3f33cAwrA2O+mcGYFjb5fMXr/ReQM3mrq6+YRQ1/GtiDHScxhEK2v+bW+9konkH7v3zifRnaJoVSXeoRNI/siTpz7gJn+Dx/BLnWtiyuQYAGB2e8KYVj8HYwppqmePA4ozA2EIUxokNbdQZAceKUEIe07lBy8fygNVdvmn1NDn5RRp4QhcHrYRoPhZmmKSB3xY2djJ7EE/lpUQqq6wGOIVPZpREuiDHUzktvlvMIbYAgNXFq4/m1+DhbAhGnRw8mGGVl6sSvPBKX4/0Ovv7b1+q1g+3oAk1mDyA90wBfImaXmt6yO/VS8g7T/je1HLw7km+Jbx3HEvB+7YlbujYoZ3yG6sHMq8Pyoqq+hNVmFrJAhOrgKwomqLpgoeFlm84yyQNtYYS0wVrkqrUGips7exqlXoD6hKoDQ1AEGtFBGOYjtM4QlHtJ58y8/n35iTFwzNXVJ3AIzA+H4aneASeUzFtgliH6W+C2PqX02njh2UfZ1tkZfsiW7ZRP6t2mq28poPVN3Ro/5UrUMe/b6f/AvlCfdR3C4+hAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/22b75cf155ec667c2040ad5b047ba6ec/f058b/image-4.png\"\n        srcset=\"/static/22b75cf155ec667c2040ad5b047ba6ec/c26ae/image-4.png 158w,\n/static/22b75cf155ec667c2040ad5b047ba6ec/6bdcf/image-4.png 315w,\n/static/22b75cf155ec667c2040ad5b047ba6ec/f058b/image-4.png 630w,\n/static/22b75cf155ec667c2040ad5b047ba6ec/cecac/image-4.png 728w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>여러 개의 <code class=\"language-text\">AuthenticationProvider</code> 인스턴스를 갖는 이유는, 여러 가지의 로그인 방법을 지원하기 위해서다. id와 password뿐만 아니라 구글, 페이스북 로그인을 동시에 지원하는 것이 좋은 예시이다.</p>\n<h2 id=\"authenticationprovider\" style=\"position:relative;\"><a href=\"#authenticationprovider\" aria-label=\"authenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>AuthenticationProvider</h2>\n<p>여러 인증 방법을 지원하기 위해 각 방법마다 인스턴스를 나눠 구현하게 되는데, 그 구현을 위한 인터페이스다.</p>\n<p>username과 password로 인증을 하는 객체는 <code class=\"language-text\">DaoAuthenticationProvider</code>로, 이 인터페이스를 상속받고 있다.</p>\n<p><code class=\"language-text\">DaoAuthenticationProvider</code>는 <code class=\"language-text\">UserDetailsService</code>에서 <code class=\"language-text\">UserDetail</code> 즉, 계정 정보를 갖고 오는 역할을 갖는다. 따라서 단순히 username과 password로 인증을 한다면 단순히 이 객체가 요구하는 <code class=\"language-text\">UserDetailsService</code>와 <code class=\"language-text\">UserDetail</code>객체를 <code class=\"language-text\">Bean</code>으로 주입하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f4b2091b45f3a0f14a7dfae44d11fa2c/e1031/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEK0lEQVR42oWTa0ybZRTHH8WBmX5QIUYXE0z8pJ+YIYti+GCmlGwOzSLJJIwPGyMjA5QOsGOwF11BNm7CCq5zs5Rby1ugrEBLOyhXgUJv9l524dJCoEBbLqWl79v3mLfgx8Unz8lJ/uc8vw//cx50sajh/O1hv/fqg1m4XD9KXfpdCZcbRumgrnAmoUS27cOkO58ghBCGwavo/07enfas2ol9+LlVBwW8GaqIr4brfA0UNquoohYNVAxvk0ye5nRW7Ug8Wwln2Uo/g60kGGwlMH5R+BkVY5DEVhJni7tdn4aB9YPOBNGQjRDLZ4lehSYomXhGiMYXCbFcFRTLZ6nOIbunUmRNKO936gu7liCPbwzlt1ngp1Yz5PH0kPNISxZL1uH28EF/GGjC8cg/Hlu+bhhY/q5R7jzXJHOmcEc3UhqlznMN/Qvna8XPE00c7M1y6ZplwLwPKoszOG5wkmP6ZZLOs9aVA8U8AaUKvxgh9Dq6WFD/bdmTvYmMmiFjeqVUl1El16dVSPTpd2S6jJonxhKFf4oj1sWVyzcNNjfA9sZKyLG0CIsLL2BxYQFczgXy2S4Aew4ECKE4xKzHM+umgnBDYIVioYViCcxQ1GGC4k4rdRO3Qc10KMgWGxmVPebHzROuBZnBY5Botsz9ere5T+s29aldpkdKx1rVeOhXhNBJVNu3lCgYsoFYaQDhoJrCh+3QrnwB3UN6qmfYAC1yawAb8MYDYJHV1dyYz8+kxZ5KzvwgIeXSiS/PpMV+k4XF1PF4b9H2RURFJSN5i/yN+yLNaQ6uT64Tqhn3hHpGXZeR0SjSJdHa3TbdF6mpeMTRUrwShaI+PIaOxR1Hx08iFPURQug1upB+9fq7Me+dYIabXrZSAId7t7rhi9/0Bm569oPM9a39IsmkrUI4ZLr71OEu3vWR+auuHQwAvkIIfYZSU1Mj8msG32Fy1TGse6poFt8SzeKropnVIzGs39rfpoH7gSATwociyRAFCmsARFo/uH2hsHZYg47wUK7klVxgCa3abO7089yHc/bs+9P2XJ5uPr/NbL8hsCfSwO0AlU+/CBD0BWLV5SUXnRtkMASEPwiBI2BLGFhaXptYIfpHWdquncY6NJO32jWTmEA3VdZpGsmpGTxFA6UTxoJq2TLcEllIDDdDqdAIJUIjYCILlHXZyEqpA/BZTy9C6GOUmVeaxWozrF/jzhzkcP/2ZXNGfbkPZvw//qXdK2g2JtFA+Zi6sGt8HngDWoIv01H8fhXV3DdFtSr0VLNUR+Dj8zCsc8jCxldxHsZyxao0Ts/cD3Q09WouNInVaZxe7fdsbvf7dM/ukYcUdeiXxbEDc0+3gKBoMRTWDg5IyX+TfOmUcRyPpLNzw3dt3eOnNnYC7lW33yuc8Xj/HNv02ld8XvdecMu1HYA1t5/+Kehf/evJao/kkO4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/f4b2091b45f3a0f14a7dfae44d11fa2c/f058b/image-5.png\"\n        srcset=\"/static/f4b2091b45f3a0f14a7dfae44d11fa2c/c26ae/image-5.png 158w,\n/static/f4b2091b45f3a0f14a7dfae44d11fa2c/6bdcf/image-5.png 315w,\n/static/f4b2091b45f3a0f14a7dfae44d11fa2c/f058b/image-5.png 630w,\n/static/f4b2091b45f3a0f14a7dfae44d11fa2c/e1031/image-5.png 803w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">DaoAuthenticationProvider</code>는 전체 흐름 속에서 <code class=\"language-text\">ProviderManager</code>가 갖는 <code class=\"language-text\">AuthenticationProviders</code>에 속하므로, 인증 과정 속에서 Credential을 인증하게 된다.</p>\n<p>저장되어 있는 계정 정보는 <code class=\"language-text\">UserDetailsService</code>로 얻어오고, 비밀번호를 암호화하는 방법은 정해진 <code class=\"language-text\">PasswordEncoder</code> 구현체를 실행함으로 정해진다. 기본적으로는 BCrypt를 사용한다. 이 방법으로 계정을 생성하면 이런 형태로 저장된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f02ecf57b86250916f36cc7ef7345708/9a1cf/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAhElEQVR42nWOSQrFIBBEs88gGENUHIkLB7z/8erTDcnuLx5dVWhXLyklxBgRQuBJXkqJdV2x7/tftm3DcRwQQvD767qglMLinEMpBTlnZs6J53k+TyWvJqiQIG2t5SXeez6IWLTWvOC+bw5aawwt7r1jjIFaK2evJ00Z/aNCYwxfep4nfpPPT8+7/zNlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/f02ecf57b86250916f36cc7ef7345708/f058b/image-6.png\"\n        srcset=\"/static/f02ecf57b86250916f36cc7ef7345708/c26ae/image-6.png 158w,\n/static/f02ecf57b86250916f36cc7ef7345708/6bdcf/image-6.png 315w,\n/static/f02ecf57b86250916f36cc7ef7345708/f058b/image-6.png 630w,\n/static/f02ecf57b86250916f36cc7ef7345708/9a1cf/image-6.png 924w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>비밀번호를 저장할 때 {bcrypt}를 꼭 prefix로 붙여야 한다. 안 붙이면  <code class=\"language-text\">java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id \"null\"</code> 이런 오류를 얻는다.</p>\n<p><a href=\"https://taesan94.tistory.com/119\">🔗참조 블로그</a>에서 자세히 설명해주고 있다.</p>\n</blockquote>\n<h1 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>구현</h1>\n<p>길게 얘기했는데 오늘 한건 정말 단순하다. SpringConfig 클래스를 생성해서 내가 직접 만든 <code class=\"language-text\">UserDetailsService</code>와 <code class=\"language-text\">UserDetails</code> 객체를 주입했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// springconfig.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableWebSecurity</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>bcrypt<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BCryptPasswordEncoder</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomeUserDetailsService</span> <span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomeUserDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// CustomUserDetailsService.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetails</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetailsService</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UsernameNotFoundException</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Optional</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomeUserDetailsService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CustomUserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Users</span><span class=\"token punctuation\">></span></span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// CustomUserRepository.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>jpa<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JpaRepository</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Repository</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Optional</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CustomUserRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Users</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Users</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Users.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">jakarta<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Column</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">jakarta<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Entity</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">jakarta<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GeneratedValue</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">jakarta<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Id</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GrantedAuthority</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetails</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collection</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Users</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> isEnabled<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Users</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Users</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// return null for test</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> password<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> username<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// return true for test</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonLocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCredentialsNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> isEnabled<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트를 위해 임의로 몇몇 필드는 생략했는데 잘 동작한다.</p>","frontmatter":{"title":"24-1-18 Spring Security 비밀번호 로그인","date":null,"description":null,"tags":["TIL","spring"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#spring-security\">Spring Security</a></p>\n</li>\n<li>\n<p><a href=\"#authentication\">Authentication</a></p>\n<ul>\n<li><a href=\"#filter-chain\">Filter Chain</a></li>\n<li><a href=\"#basic-login-flow\">Basic Login Flow</a></li>\n<li><a href=\"#authenticationmanager\">AuthenticationManager</a></li>\n<li><a href=\"#providermanager\">ProviderManager</a></li>\n<li><a href=\"#authenticationprovider\">AuthenticationProvider</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B5%AC%ED%98%84\">구현</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/til/24-1-12-docker-build/"},"frontmatter":{"title":"24-1-12 docker build","date":"January 12, 2024"}},"next":null},"pageContext":{"id":"13c6228f-5b21-571e-ba15-c99e15fab814","previousPostId":"7f50860a-2b66-5b76-9940-f42b0c506485","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}