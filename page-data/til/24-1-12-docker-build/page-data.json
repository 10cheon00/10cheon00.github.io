{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/24-1-12-docker-build/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"7f50860a-2b66-5b76-9940-f42b0c506485","excerpt":"docker build 를 통해 Dockerfile에 명시된 설정대로 image를 생성한다. 생성된 이미지는 을 통해 컨테이너에 담겨 실행된다. Spring boot 로컬 환경에서 개발하고 있는 Spring boot…","html":"<h1 id=\"docker-build\" style=\"position:relative;\"><a href=\"#docker-build\" aria-label=\"docker build permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>docker build</h1>\n<p><code class=\"language-text\">docker build</code>를 통해 Dockerfile에 명시된 설정대로 image를 생성한다. 생성된 이미지는 <code class=\"language-text\">docker run</code>을 통해 컨테이너에 담겨 실행된다.</p>\n<h2 id=\"spring-boot\" style=\"position:relative;\"><a href=\"#spring-boot\" aria-label=\"spring boot permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Spring boot</h2>\n<p>로컬 환경에서 개발하고 있는 Spring boot 프로젝트를 도커 컨테이너에 올리려고 다음과 같은 방법을 사용했다.</p>\n<p>일단 테스트를 위해 HelloWorld를 출력하는 컨트롤러를 하나 만들었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dockertutorial<span class=\"token punctuation\">.</span>example</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RequestMapping</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloWorld</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token class-name\">ReturnHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"HelloWorld\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그런다음 <code class=\"language-text\">./gradlew build</code>로 프로젝트를 빌드하여 jar파일을 만들고, 프로젝트 루트에 만들어놓은 Dockerfile을 실행하여 image를 생성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Dockerfile</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> openjdk:17</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> JAR_FILE=build/libs/*-SNAPSHOT.jar</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> <span class=\"token variable\">${JAR_FILE}</span> app.jar</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [<span class=\"token string\">\"java\"</span>, <span class=\"token string\">\"-jar\"</span>, <span class=\"token string\">\"/app.jar\"</span>]</span></code></pre></div>\n<blockquote>\n<p>java 17버전을 사용했다.</p>\n</blockquote>\n<p>image를 생성하기 위해 프로젝트 루트에서 다음과 같은 명령어를 실행했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> dockertutorial:0.0.4 <span class=\"token builtin class-name\">.</span>\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                                                                                                           <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 157B                                                                                                                                                                                                           <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                                                                                                                <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:17                                                                                                                                                                                  <span class=\"token number\">1</span>.3s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 116B                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/2<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:17@sha256:528707081fdb9562eb819128a9f85ae7fe000e2fbaeaf9f87662e7b3f38cb7d8                                                                                                                            <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> CACHED <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/2<span class=\"token punctuation\">]</span> COPY build/libs/*-SNAPSHOT.jar app.jar                                                                                                                                                                                        <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                                                                                                                         <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                                                                                                                        <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:de7cc8dfa14d2cfd123a6a000b383681224eb275d82567eaad6b7eda39e98c36                                                                                                                                                   <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/dockertutorial:0.0.4            </code></pre></div>\n<p>여기까지 한다음 <code class=\"language-text\">docker images</code>를 실행하면 방금 생성한 이미지가 나타난다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> images\nREPOSITORY                 TAG       IMAGE ID       CREATED             SIZE\ndockertutorial             <span class=\"token number\">0.0</span>.4     de7cc8dfa14d   <span class=\"token number\">9</span> minutes ago       494MB\nmysql                      latest    73246731c4b0   <span class=\"token number\">3</span> weeks ago         619MB\nhello-world                latest    d2c94e258dcb   <span class=\"token number\">8</span> months ago        <span class=\"token number\">13</span>.3kB</code></pre></div>\n<p>생성한 image를 실행하여 컨테이너에 올리기 위해 다음과 같이 실행했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">10011</span>:8080 <span class=\"token parameter variable\">--name</span> dockertutorial dockertutorial:0.0.4\nbf3f65653bc59ce425ec11da831c6ca49ea5647d00ed5958698649a5524e6aa2</code></pre></div>\n<blockquote>\n<p>포트포워딩을 위해 8080을 10011로부터 포워딩했다.\n:0.0.4처럼 tag를 붙여서 image를 구분할 수 있다.</p>\n</blockquote>\n<p>잘 실행되었는지 확인하기 위해 <code class=\"language-text\">docker ps</code>를 실행하면 이렇게 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span>\nCONTAINER ID   IMAGE                  COMMAND                CREATED              STATUS              PORTS                                         NAMES\nbf3f65653bc5   dockertutorial:0.0.4   <span class=\"token string\">\"java -jar /app.jar\"</span>   About a minute ago   Up About a minute   <span class=\"token number\">0.0</span>.0.0:10011-<span class=\"token operator\">></span><span class=\"token number\">8080</span>/tcp, :::10011-<span class=\"token operator\">></span><span class=\"token number\">8080</span>/tcp   dockertutorial</code></pre></div>\n<h2 id=\"mysql\" style=\"position:relative;\"><a href=\"#mysql\" aria-label=\"mysql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Mysql</h2>\n<p>mysql image는 원격 서버에서 받아야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker pull mysql</code></pre></div>\n<p>mysql을 컨테이너에 그대로 올리면 바로 종료된다. <code class=\"language-text\">docker ps -a</code>로 확인하면 이렇다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">10012</span>:3306 <span class=\"token parameter variable\">--name</span> database mysql:latest\na46115bed622b1153211179c281711f046cca26a1e74c85a37dcb195b76dd2e0\n\nubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-a</span>\nCONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                        PORTS                                         NAMES\na46115bed622   mysql:latest           <span class=\"token string\">\"docker-entrypoint.s…\"</span>   <span class=\"token number\">33</span> seconds ago   Exited <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">32</span> seconds ago                                                   database</code></pre></div>\n<blockquote>\n<p>포트포워딩을 10012에서 3306으로 향하도록 설정했다.</p>\n</blockquote>\n<p>어떤 오류를 내는지 확인하기 위해 <code class=\"language-text\">docker container logs database</code>를 실행하면 이렇게 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ <span class=\"token function\">docker</span> container logs database\n<span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:40:15+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Entrypoint script <span class=\"token keyword\">for</span> MySQL Server <span class=\"token number\">8.2</span>.0-1.el8 started.\n<span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:40:15+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Switching to dedicated user <span class=\"token string\">'mysql'</span>\n<span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:40:15+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Entrypoint script <span class=\"token keyword\">for</span> MySQL Server <span class=\"token number\">8.2</span>.0-1.el8 started.\n<span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:40:16+00:00 <span class=\"token punctuation\">[</span>ERROR<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Database is uninitialized and password option is not specified\n    You need to specify one of the following as an environment variable:\n    - MYSQL_ROOT_PASSWORD\n    - MYSQL_ALLOW_EMPTY_PASSWORD\n    - MYSQL_RANDOM_ROOT_PASSWORD</code></pre></div>\n<p>필수적으로 설정해야하는 환경변수가 존재하기 때문에, 컨테이너에 올릴 때 항상 옵션으로 넣어야 한다. 로그에서 볼 수 있듯 세 가지 옵션 중에 하나는 무조건 넣어야 한다고 한다.</p>\n<p><a href=\"https://hub.docker.com/_/mysql#Environment-Variables\">'mysql - Official Image | Docker Hub'</a> 이 링크에서 설정할 수 있는 환경변수를 명시하고 있다.</p>\n<p>문서를 읽어보면 <code class=\"language-text\">MYSQL_ROOT_PASSWORD</code>를 항상 요구하고 있다. 따라서 컨테이너를 실행할 때 이렇게 실행하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ docker run -d -p 10012:3306 --name database -e MYSQL_ROOT_PASSWORD=password mysql:latest\n7e6ae1b3f7be97bc063105de1834c1b23f0b0c4075bbc8e26f813091f152b559\n\nubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial$ docker container logs database\n2024-01-12 13:51:20+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.2.0-1.el8 started.\n2024-01-12 13:51:20+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'\n2024-01-12 13:51:20+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.2.0-1.el8 started.\n2024-01-12 13:51:20+00:00 [Note] [Entrypoint]: Initializing database files\n2024-01-12T13:51:20.566833Z 0 [System] [MY-015017] [Server] MySQL Server Initialization - start.\n2024-01-12T13:51:20.567560Z 0 [Warning] [MY-011068] [Server] The syntax '--skip-host-cache' is deprecated and will be removed in a future release. Please use SET GLOBAL host_cache_size=0 instead.\n2024-01-12T13:51:20.567597Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.2.0) initializing of server in progress as process 79\n2024-01-12T13:51:20.575524Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.\n2024-01-12T13:51:21.721999Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.\n</code></pre></div>\n<h1 id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>docker-compose</h1>\n<p>spring boot 프로젝트와 mysql을 컨테이너에 올렸다 내렸다 하려면 명령어를 여러개 쳐야한다. 상당히 복잡한데 이걸 yml파일로 명시하여 한 번에 여러 개의 컨테이너를 생성하기 위해 <code class=\"language-text\">docker-compose</code>를 사용한다고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.8'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> mysql\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span>latest\n\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> password\n      <span class=\"token key atrule\">MYSQL_USER</span><span class=\"token punctuation\">:</span> admin\n      <span class=\"token key atrule\">MYSQL_PASSWORD</span><span class=\"token punctuation\">:</span> password1\n      <span class=\"token key atrule\">MYSQL_DATABASE</span><span class=\"token punctuation\">:</span> TestDatabase\n\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'10012:3306'</span>\n  <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> app\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ../\n      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'10011:8080'</span>\n\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> db</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 293px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa7eed5d4c42f965f90488aef692edff/3cf3e/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 154.43037974683543%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFOUlEQVR42o2WWY/b1hmGdR2gTjwSSa2WNNooiqR2buKq1TPjWZIZOxuQxrGnsWE4Abqg7V0DN03/QDBpCgMFCvS2N0UviiKY3PW2v+gpSGnGcWOPffHgI8jDl+d85/2+w1SlWqVSqTBxQ/S+hWPbWKaF40xwXY/haIwzcTANE8d2yGWziJKE9BJSzUaDZqOG6UQY3j57qxme6zGbTpmGAZbjsJjPCT2P1XLBdrVMpfJyUoFrE3o281nIyhuxZygc7C55984xH37wPh++d8zEGuJYI2xzSOg7V5LqKDIxuq4yHvSIHAN3Es9qhu+5GOMh6mZMjNJuXUlK2uSkdKOErKgsdg5QVJ3lcoVlmqS3riOI4muTMsZ9YhzHwrcG3LT7LKYBy8WU1XKGbY64GPM6pOIXJrZBELhMJwa7do+j/T2Oj9/h8PAWpjHEtgwc+/VIFQoFJOE6pXwGuVUjDAO6uoJjDbHGPbR2DTH9E4StF/CC+6lCoYg8WNH17jCK3md29BB375Tdd3/O6uQx0f4pHfOQjnX0IxRzHdUf3EuVblS5+fBvHP3me/Z/8S/2Pv8Hs1/+l5u/+g93f/dP7n7xbx589T0ff3HOJ0/O+fQP5zz86pzT359z+uU5956c87Mvz3nnt99x+OvvSOULBVq9iO7kiFFwm+nBfXT3DgP/Nu7qA0b+26jGDh1jF3WDbq6jZl5c79AerUnl83nEzFsUshma9SqObeFODEJ/kuzyoNvhrWtvIKTfJLN1bc31dUxfv0Z6c0/YkAjmcnnK5TJtpUMYzekPRnR1nfhZNpcnny8kY7K53CvZCOYolUrU6w08L0TTu7TbbQRBIJPJIGQySFkpGZfNZq8kEYwvMuk0sqywu3eI0tGYTqfMZrOk6/h+QL1eTz7wKtG1YC6HmJWoVKoMRyaD4YjBcIhhmqiahqZpyLJMvIGvtWRJEsgIGWS5hec6WJZNFE1xXI9oOicMI27d2kdTO6TTW2Szce8TX0iqWCozOXnC/O4Z4cffYn/0V/ZOv+bgwRn7n55x8tlTjh+dsXP/a6Y/fTWpYqmC994fWZ4+Jbr3F9z7f+fgwTecPPqG40d/4ujhGbcff8vx46fMPvkz83tXc2kbQcrR7Q04evsE0/Zw3JBotiSI5rQVDUHMkS+UyOWLV7LJoYQgpKnVa0xcn8FgQL/fSxj0e9Rr20hivMPZl+buMoeXuyxJVLe3Ew8OxwZRNGOxWBIEYWKdnd1dNFVlayuNJGXXkxAlRFFaN1dBJJvNPfNhrF4uV1BVHbndptNR6Xa7dDodZLmNoijIrRaNRiOx1/b2Nq1mM4nt9vpZrHUpKIoi1WoZXVMwLZsgjBLrhGGIYRgsFovkiPU8L7GRuzkFZ7M5nu9zc2cnSc2zGYoCN+o6ZSWg3x8ShSHD4YCu3sU0LYrFYrLMi4/H1+LFWSIICcm5fCEYm7VYbtJQXdrtDuPxGF1TabVa9Hq95OW4ruOYjM+tSy0uxdxFpcSld1Gb6XQ6mfLEsZJu4/o+E8fB8z1GYyOJYTRjtVpR264+E/7/Wr5RLifJbLVkFEVF6ahJG4sto2k6w+EIwxgzGo/o9vroukapWHx+dj8UrNVqSX7iPhh3FdcLCIIA2zJxPR9d0/E8H8dxkhnGPwHxauLlxzHO3XOC1WqVfE6kNw7QrT3UjozcVhLPdfVeYpdGo3nZceI+qaqdzSoGtJqNy81KBGMfFQr5ZKnNtobve4lt3InLZOJiWQaj0RjXcxkOBomF4m5kWg6+79PvdZ/L5/8AhkTJqCdY00gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/fa7eed5d4c42f965f90488aef692edff/3cf3e/image.png\"\n        srcset=\"/static/fa7eed5d4c42f965f90488aef692edff/c26ae/image.png 158w,\n/static/fa7eed5d4c42f965f90488aef692edff/3cf3e/image.png 293w\"\n        sizes=\"(max-width: 293px) 100vw, 293px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">docker-compose.yml</code>을 deploy폴더에 넣어두고 위와 같이 작성했다.</p>\n<p>그다음 <code class=\"language-text\">docker-compose build</code>, <code class=\"language-text\">docker-compose up</code>으로 이미지 생성과 컨테이너 실행을 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/dockertutorial/deploy$ <span class=\"token function\">docker-compose</span> build<span class=\"token punctuation\">;</span> <span class=\"token function\">docker-compose</span> up\ndb uses an image, skipping\nBuilding app\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Building <span class=\"token number\">0</span>.9s <span class=\"token punctuation\">(</span><span class=\"token number\">7</span>/7<span class=\"token punctuation\">)</span> FINISHED                                                                                                                                                                                                     docker:default\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load .dockerignore                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 2B                                                                                                                                                                                                                <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build definition from Dockerfile                                                                                                                                                                                           <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring dockerfile: 157B                                                                                                                                                                                                           <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load metadata <span class=\"token keyword\">for</span> docker.io/library/openjdk:17                                                                                                                                                                                  <span class=\"token number\">0</span>.7s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>internal<span class=\"token punctuation\">]</span> load build context                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> transferring context: 116B                                                                                                                                                                                                              <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/2<span class=\"token punctuation\">]</span> FROM docker.io/library/openjdk:17@sha256:528707081fdb9562eb819128a9f85ae7fe000e2fbaeaf9f87662e7b3f38cb7d8                                                                                                                            <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> CACHED <span class=\"token punctuation\">[</span><span class=\"token number\">2</span>/2<span class=\"token punctuation\">]</span> COPY build/libs/*-SNAPSHOT.jar app.jar                                                                                                                                                                                        <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting to image                                                                                                                                                                                                                         <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> exporting layers                                                                                                                                                                                                                        <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> writing image sha256:de7cc8dfa14d2cfd123a6a000b383681224eb275d82567eaad6b7eda39e98c36                                                                                                                                                   <span class=\"token number\">0</span>.0s\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> naming to docker.io/library/deploy_app                                                                                                                                                                                                  <span class=\"token number\">0</span>.0s\nRecreating mysql <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span>\nRecreating app   <span class=\"token punctuation\">..</span>. <span class=\"token keyword\">done</span>\nAttaching to mysql, app\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:59:09+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Entrypoint script <span class=\"token keyword\">for</span> MySQL Server <span class=\"token number\">8.2</span>.0-1.el8 started.\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:59:09+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Switching to dedicated user <span class=\"token string\">'mysql'</span>\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:59:09+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Entrypoint script <span class=\"token keyword\">for</span> MySQL Server <span class=\"token number\">8.2</span>.0-1.el8 started.\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12 <span class=\"token number\">13</span>:59:09+00:00 <span class=\"token punctuation\">[</span>Note<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Entrypoint<span class=\"token punctuation\">]</span>: Initializing database files\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:09.428635Z <span class=\"token number\">0</span> <span class=\"token punctuation\">[</span>System<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>MY-015017<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Server<span class=\"token punctuation\">]</span> MySQL Server Initialization - start.\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:09.429384Z <span class=\"token number\">0</span> <span class=\"token punctuation\">[</span>Warning<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>MY-011068<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Server<span class=\"token punctuation\">]</span> The syntax <span class=\"token string\">'--skip-host-cache'</span> is deprecated and will be removed <span class=\"token keyword\">in</span> a future release. Please use SET GLOBAL <span class=\"token assign-left variable\">host_cache_size</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> instead.\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:09.429423Z <span class=\"token number\">0</span> <span class=\"token punctuation\">[</span>System<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>MY-013169<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Server<span class=\"token punctuation\">]</span> /usr/sbin/mysqld <span class=\"token punctuation\">(</span>mysqld <span class=\"token number\">8.2</span>.0<span class=\"token punctuation\">)</span> initializing of server <span class=\"token keyword\">in</span> progress as process <span class=\"token number\">80</span>\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:09.446686Z <span class=\"token number\">1</span> <span class=\"token punctuation\">[</span>System<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>MY-013576<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>InnoDB<span class=\"token punctuation\">]</span> InnoDB initialization has started.\nmysql  <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:10.602298Z <span class=\"token number\">1</span> <span class=\"token punctuation\">[</span>System<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>MY-013577<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>InnoDB<span class=\"token punctuation\">]</span> InnoDB initialization has ended.\napp    <span class=\"token operator\">|</span> \napp    <span class=\"token operator\">|</span>   <span class=\"token builtin class-name\">.</span>   ____          _            __ _ _\napp    <span class=\"token operator\">|</span>  /<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span> / ___<span class=\"token string\">'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\napp    | ( ( )\\___ | '</span>_ <span class=\"token operator\">|</span> <span class=\"token string\">'_| | '</span>_ <span class=\"token punctuation\">\\</span>/ _` <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span> <span class=\"token punctuation\">\\</span>\napp    <span class=\"token operator\">|</span>  <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span>/  ___<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span>_<span class=\"token punctuation\">)</span><span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">|</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_<span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>\napp    <span class=\"token operator\">|</span>   <span class=\"token string\">'  |____| .__|_| |_|_| |_\\__, | / / / /\napp    |  =========|_|==============|___/=/_/_/_/\napp    |  :: Spring Boot ::                (v3.2.1)\napp    | \napp    | 2024-01-12T13:59:10.949Z  INFO 1 --- [           main] c.d.example.ExampleApplication           : Starting ExampleApplication using Java 17.0.2 with PID 1 (/app.jar started by root in /)\napp    | 2024-01-12T13:59:10.953Z  INFO 1 --- [           main] c.d.example.ExampleApplication           : No active profile set, falling back to 1 default profile: \"default\"\napp    | 2024-01-12T13:59:11.513Z  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)\napp    | 2024-01-12T13:59:11.521Z  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]\napp    | 2024-01-12T13:59:11.522Z  INFO 1 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.17]\napp    | 2024-01-12T13:59:11.545Z  INFO 1 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\napp    | 2024-01-12T13:59:11.546Z  INFO 1 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 538 ms\napp    | 2024-01-12T13:59:11.772Z  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '</span>'\napp    <span class=\"token operator\">|</span> <span class=\"token number\">2024</span>-01-12T13:59:11.781Z  INFO <span class=\"token number\">1</span> --- <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> c.d.example.ExampleApplication           <span class=\"token builtin class-name\">:</span> Started ExampleApplication <span class=\"token keyword\">in</span> <span class=\"token number\">1.093</span> seconds <span class=\"token punctuation\">(</span>process running <span class=\"token keyword\">for</span> <span class=\"token number\">1.361</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>근데 잘 되는데, 세세한 설정을 모르기 때문에 좀 더 공부가 필요하다.</p>","frontmatter":{"title":"24-1-12 docker build","date":"January 12, 2024","description":null,"tags":["TIL","docker"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#docker-build\">docker build</a></p>\n<ul>\n<li><a href=\"#spring-boot\">Spring boot</a></li>\n<li><a href=\"#mysql\">Mysql</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#docker-compose\">docker-compose</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/til/24-1-11-docker-이해하기/"},"frontmatter":{"title":"24-1-11 docker 이해하기","date":"January 11, 2024"}},"next":{"fields":{"slug":"/til/24-1-18-spring-security/"},"frontmatter":{"title":"24-1-18 Spring Security 비밀번호 로그인","date":null}}},"pageContext":{"id":"7f50860a-2b66-5b76-9940-f42b0c506485","previousPostId":"790edec3-1f59-53ec-afb5-f39b7e56ad7d","nextPostId":"13c6228f-5b21-571e-ba15-c99e15fab814"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}