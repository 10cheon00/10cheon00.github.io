{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/24-1-22-docker-network/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"51b222f5-34e4-59ca-b3d5-4eedbc689b73","excerpt":"docker network 각 컨테이너가 외부 또는 다른 컨테이너와 상호작용하려면 도커의 네트워크를 이해해야한다. 컨테이너가 생성될 때 네트워크 설정을 하지 않았다면  네트워크로 연결된다. 각 네트워크는 Driver와 Scope속성을 갖는다. Driver…","html":"<h1 id=\"docker-network\" style=\"position:relative;\"><a href=\"#docker-network\" aria-label=\"docker network permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>docker network</h1>\n<p>각 컨테이너가 외부 또는 다른 컨테이너와 상호작용하려면 도커의 네트워크를 이해해야한다.</p>\n<p>컨테이너가 생성될 때 네트워크 설정을 하지 않았다면 <code class=\"language-text\">bridge</code> 네트워크로 연결된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ubuntu@DESKTOP-GMH7007:~/workspace/learn-spring-security/jdbc$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">--name</span> ubuntu_container <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-d</span> ubuntu\ndfb4cd7647eea3508210e07b82e61b58aa0f85d6d1c4a5b3cd9e21110ba5d4a9\nubuntu@DESKTOP-GMH7007:~/workspace/learn-spring-security/jdbc$ <span class=\"token function\">docker</span> network inspect bridge\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"bridge\"</span>,\n        <span class=\"token string\">\"Scope\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"local\"</span>,\n        <span class=\"token string\">\"Driver\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"bridge\"</span>,\n        <span class=\"token comment\"># ...</span>\n        <span class=\"token string\">\"Containers\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"dfb4cd7647eea3508210e07b82e61b58aa0f85d6d1c4a5b3cd9e21110ba5d4a9\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"Name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"ubuntu_container\"</span>,\n                <span class=\"token string\">\"EndpointID\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8366e1486ff8a832881cb41d667bf0d70d5a17e8f7ecc43fab1c12e68d60b108\"</span>,\n                <span class=\"token string\">\"MacAddress\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"02:42:ac:11:00:02\"</span>,\n                <span class=\"token string\">\"IPv4Address\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"172.17.0.2/16\"</span>,\n                <span class=\"token string\">\"IPv6Address\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>,\n        <span class=\"token comment\"># ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>각 네트워크는 Driver와 Scope속성을 갖는다. Driver는 네트워크간 연결 방식을 말하고, Scope는 네트워크의 범위를 의미한다.</p>\n<p>vlan과 연관된 driver를 제외한 나머지 driver의 의미를 정리하면 이렇다.</p>\n<table>\n<thead>\n<tr>\n<th>Driver</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bridge</td>\n<td>기본 driver. 네트워크 내에 여러 컨테이너를 포함시켜 통신하게한다.</td>\n</tr>\n<tr>\n<td>host</td>\n<td>호스트와 네트워크간 격리를 제거하고 호스트의 네트워크를 사용한다.</td>\n</tr>\n<tr>\n<td>none</td>\n<td>호스트 및 다른 컨테이너와 같은 네트워크로 연결되지 않는다.</td>\n</tr>\n<tr>\n<td>overlay</td>\n<td>여러 도커 데몬 사이에서 통신할 수 있도록 만든다.</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"bridge-네트워크-다이어그램\" style=\"position:relative;\"><a href=\"#bridge-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8\" aria-label=\"bridge 네트워크 다이어그램 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>bridge 네트워크 다이어그램</h1>\n<p>spring과 mysql을 각각 도커에 띄운 후 두 컨테이너를 연결하려고 같은 네트워크에 두었는데 이상하게 자꾸 연결을 하지 못했다. 이유는 같은 네트워크에 있다면 로컬 포트를 이용해야하는데, 포트포워딩된 포트를 이용하려고 했었기 때문이었다.</p>\n<p>먼저 <code class=\"language-text\">docker compose</code>를 사용해서 두 컨테이너에 각각 spring과 mysql을 올렸다. 그렇다면 네트워크 다이어그램은 아래 그림처럼 구성된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db7ed6990c9f7e0dc85ca913feb3826c/87a80/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABaElEQVR42p2T0coTMRCF++o+hq+hL6DgjVciqDeW/6q1WHGTZru7mcxkPkm21bY/IjhwYJhMTs7JJJsYI2EIhBA74n8jMAwDm5QS4JgXHL1DxTD0DvWhZ+1re+tKOI4jRmFR5ZQLU6lMWkmiZDPcK/UGYtbXxgtOoixqFM+EENikMfVTkxjmMOZEXOKal4pzH62mFaw61aG2mlSKy5VwVTgbHMdvvHz3gjdfX/VraJur+zPCa20SxWrlXBphWQlXy0qusP3xhbfb1+ziE2ILk/ozwlmdlAvbw5Hx+ydEZiblj8JG6Fi33OLj/j2fDx9+q3ng67Vm9zQLkhea6WZZrgqb5XaH5z4MJ8wQFu95U9PC3DquChuOZ+MwWu87F0e7wsuUlUK2zGLCYkvHrIJUoVQhlcCp/Ox5w6yZXHNfn03IJjdD6e8Q/NHbTahpx7+iv8P2U4abn/KIGE/s93t2u13P/9YXLj/lF9f/Vvv7ib/OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/db7ed6990c9f7e0dc85ca913feb3826c/f058b/image.png\"\n        srcset=\"/static/db7ed6990c9f7e0dc85ca913feb3826c/c26ae/image.png 158w,\n/static/db7ed6990c9f7e0dc85ca913feb3826c/6bdcf/image.png 315w,\n/static/db7ed6990c9f7e0dc85ca913feb3826c/f058b/image.png 630w,\n/static/db7ed6990c9f7e0dc85ca913feb3826c/40601/image.png 945w,\n/static/db7ed6990c9f7e0dc85ca913feb3826c/87a80/image.png 973w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>도커에서 이미지를 컨테이너에 올릴 때 포트포워딩 옵션을 설정할 수 있다. 만약 spring에 <code class=\"language-text\">-p 9999:8080</code>옵션을, mysql에 <code class=\"language-text\">-p 12345:3306</code>옵션을 주었다고 하면 다이어그램은 이렇게 변한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7e403115d1046783837aca5666c4951/e4a12/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABmElEQVR42nWS3Y7UMAyF+9y8BS8ECAmuAIkr0AJascyM9mc6TdImbeLEH0qmuzPDsqmO7DrHR7bjru8PDIM5w/CPfQmXPDMY+r6nm/yEomQVCpfIL+AZT1PTcM7RucmSSXjJ2FitNtgoxJxRLZQV1a8xF4UxSrMuZkLKTcPYgW70jqiCT0o9B7/HLZaYYUqFx6OrrbGYlVyUorrGlEjGOlNbdoSSEIXr/huv373i081bpNRKT4KcCda75sdMLoUgylIE9ySYE5Xz5c97vm4/cut+M6WZIM/0mLNy8JGr3T3j7jPLPDJnWFRw4yo4F2EWKEX48OsN1/vv1Nom+X/LtcJpScwxtlid+ZPgODnqSOsclgxmVnyCkLW1chQ7fo/J9c7Mhbspt5yam08zHNvTpyJ4ETZhw43dYKOnVJoKoxicDM2vCLnGZn66H9z7A1KOr+ycpQs+tBqkJFQzNvXcPmwJYWqCFWHxhBiaL3VfVRCN3LkN/eGh5dYzjiNd3W6zbvoRFmNO/846tpstu+2u+edcay65+/2ev9UVVWsBUwfMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/c7e403115d1046783837aca5666c4951/f058b/image-1.png\"\n        srcset=\"/static/c7e403115d1046783837aca5666c4951/c26ae/image-1.png 158w,\n/static/c7e403115d1046783837aca5666c4951/6bdcf/image-1.png 315w,\n/static/c7e403115d1046783837aca5666c4951/f058b/image-1.png 630w,\n/static/c7e403115d1046783837aca5666c4951/40601/image-1.png 945w,\n/static/c7e403115d1046783837aca5666c4951/e4a12/image-1.png 963w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>외부에서 spring 컨테이너에 접근하려면 호스트의 9999포트를 이용하여야 하고, bridge 네트워크 내에서 mysql에 접근하려면 <strong>12345포트가 아닌 mysql의 3306포트를 이용해야한다.</strong> 다시말해, 같은 네트워크에 속한 컨테이너는 모두 로컬로 볼 수 있다.</p>\n<p>하지만 이 개념을 제대로 이해하지 못하고 계속 bridge 네트워크 속 spring 컨테이너를 mysql에 접근시키기 위해서 12345포트로 설정했었다. 로컬 네트워크에서 호스트로 포트포워딩된 포트번호로 찾으려하니 연결이 될 수가 없었던 것이다.</p>","frontmatter":{"title":"24-1-22 docker network","date":"January 22, 2024","description":null,"tags":["TIL","docker"]},"tableOfContents":"<ul>\n<li><a href=\"#docker-network\">docker network</a></li>\n<li><a href=\"#bridge-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8\">bridge 네트워크 다이어그램</a></li>\n</ul>"},"previous":{"fields":{"slug":"/til/24-1-18-spring-security/"},"frontmatter":{"title":"24-1-18 Spring Security 비밀번호 로그인","date":"January 18, 2024"}},"next":{"fields":{"slug":"/til/24-1-26-Spring-Security-Authorization/"},"frontmatter":{"title":"24-1-26 Spring Security Authorization","date":"January 26, 2024"}}},"pageContext":{"id":"51b222f5-34e4-59ca-b3d5-4eedbc689b73","previousPostId":"13c6228f-5b21-571e-ba15-c99e15fab814","nextPostId":"0d45699e-735f-5536-977e-e7d6e62bbad3"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}