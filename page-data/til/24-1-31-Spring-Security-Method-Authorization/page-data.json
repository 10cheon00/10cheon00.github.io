{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/24-1-31-Spring-Security-Method-Authorization/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"803ad70b-1e26-57db-88db-270519c661f4","excerpt":"Method Security 이전에 Authorization에 대해 공부했을 땐 로 명시된 클래스에서 직접 모든 경로에 대해 authorization을 지정했다. 그러나 세세한 엔드포인트에 대해 authorization…","html":"<h1 id=\"method-security\" style=\"position:relative;\"><a href=\"#method-security\" aria-label=\"method security permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Method Security</h1>\n<p>이전에 Authorization에 대해 공부했을 땐 <code class=\"language-text\">@Configuration</code>로 명시된 클래스에서 직접 모든 경로에 대해 authorization을 지정했다. 그러나 세세한 엔드포인트에 대해 authorization을 지정하려면 코드가 매우 길어지고 유지보수하기 까다로우므로, Spring Security에서는 메서드별로 authorization을 거는 방법을 제공하고 있다.</p>\n<h1 id=\"flow\" style=\"position:relative;\"><a href=\"#flow\" aria-label=\"flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Flow</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/28ba13c0da2a3862b31e603dd30630ea/d4b10/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmElEQVR42mMItbDgDLWQ4WRgYGCuDw1lY2BgYDB06tLTs23uMHPvr7T0nJVt5tJXYuE2NdfUbWquvv30HB2TWHsrt7pUc/eZeRYek3NN3SbnWnlNzTV0nJjLwMAgydXrZqiyPc4izNjYmBVkoFPgTCN7vwWFNl69dTaerd0OfpOrHYJmFTkFzS629J5dbOyUY+YeOqHfJXTOarfgWctdQ2et8IiYs8IhYMYihselTo4vcgyqnuSa9L3MM8raHq2rDjLUXl9fQE9PnBvMtmdgYUAC////ZwqMndvgFT5rgXPApNlugZPn+ITPmOsUMH0iw/HaiJozBW4HThW67Thf7L51XZKdJdjbhlZSMjIyQoKCDPxaWsZyILH6+nqm+vr9YMOnz1zR2zth8Yma+sn7auqn7OvsXnB0ypSlCyA2VuqIf6nVcwexZWQsOBkY7MGaHPynVFl7Ttro6Ddlhb3v1I0Gtt3xMFdGZy86mN579n/mhNN/0vtO/M2cdPF/aOGWqwxLcpf4TwubuLbLv2X5rIipi0pcSwxAGuLt7TmSsvstIzNmuSdkzHOKyZrhERA3URlmYGr+7EMLVu34P3vJ6j8zF638u2z99v8lDcuvMqxqWmW8OGdh1sKseUkg3B1YL8bAEM+hqJOpJ6MaJ80gmMbPwxMqKqo1hUdSrUdEybhDjoEhjTW7ZE5uVc2sGXUN0/tr62dMaGiaNTUjf1YNAwqor2cCUVYeU93M3WestvGducTWZ8ZKG+9pa0G0rc+MZcbOU9aqmjXp+8fPL7Dzn73EynvaHFvfGXMdA+fMsQ+YOQcc0KtCVzHX29ezzEw7w1pf/59p1apVzCCsoaEhrKioKG5vb88BiV0GRmgsM9r5TW+y85uz2NZnxlxb/1nzHALmzTN2mTKVAQ0wqqgwsKuoqLBD+RxCQkJ8enqWYugKO3uX1jU3z16dn9+xpDC/a0l97bQVza0L+uEKjH3qufStah3NHcuCrDzqvczdZhur6ntLKysry+roGGsYGxvza2lpsTEw/Ae7Mq9y8Y7s5h3/M5q2fktv3PQ9s3nH/7TK1RfAXgYpSC+dp+oaPH2LW8jsDR5hszc7Bk7boGVWrCUpySEnL6+qqaCgoG9mZsYHc0BExryD7YtO/m9ffOhP64J9f3tWnv6fULrxGgM+AEnI9UyhoaHMUIsZoZghv3TmgulTZt+bNXXqpelTpl6aN2vW7aq6WesBLWhYhguSI9oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/28ba13c0da2a3862b31e603dd30630ea/f058b/image.png\"\n        srcset=\"/static/28ba13c0da2a3862b31e603dd30630ea/c26ae/image.png 158w,\n/static/28ba13c0da2a3862b31e603dd30630ea/6bdcf/image.png 315w,\n/static/28ba13c0da2a3862b31e603dd30630ea/f058b/image.png 630w,\n/static/28ba13c0da2a3862b31e603dd30630ea/40601/image.png 945w,\n/static/28ba13c0da2a3862b31e603dd30630ea/78612/image.png 1260w,\n/static/28ba13c0da2a3862b31e603dd30630ea/d4b10/image.png 1394w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>그림에서는 <code class=\"language-text\">readCustomer</code>라는 자원에 접근하는 요청을 예시로 들고 있다.</p>\n<ol>\n<li>\n<p>자원에 접근하기 전에 Spring AOP가 해당 자원의 프록시 메서드를 호출한다. 다시 말해 <code class=\"language-text\">@PreAuthorize</code>가 명시되어 있다면 <code class=\"language-text\">AuthorizationManagerBeforeMethodInterceptor</code>를 통해 프록시 메서드를 호출한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">AuthorizationManagerBeforeMethodInterceptor</code>는 <code class=\"language-text\">@PreAuthorize</code>내에 명시된 메서드를 호출하기 위해 <code class=\"language-text\">PreAuthorizeAuthorizationManager</code>클래스를 생성자의 인자로 요구하는데, 그 클래스의 <code class=\"language-text\">check</code> 메서드를 호출한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">check</code> 메서드는 <code class=\"language-text\">@PreAuthorize</code>내에 명시된 메서드를 실행하기 위해 어떻게 명시되어있는지 해석해야 한다. 사용자는 <strong>SeEL expression</strong>으로 메서드를 표현했으므로 그 표현식을 해석하기 위해 <code class=\"language-text\">MethodSecurityExpressionHandler</code>를 필요로 요구한다.</p>\n</li>\n</ol>\n<p>이 객체는 적절한 Context객체를 생성하여 반환한다. Context 객체에는 <code class=\"language-text\">Supplier&lt;Authentication></code>과 <code class=\"language-text\">MethodInvocation</code>이 담겨 있어 상위 객체에서 직접 Authorization을 할 수 있다.</p>\n<ol start=\"4\">\n<li>\n<p>3번을 통해 얻은 Context를 이용하여 interceptor가 해당 사용자를 평가(인가)한다.</p>\n</li>\n<li>\n<p>인가되었다면 자원에 접근을 허용하고, 그렇지 않으면 AccessDeniedException을 던진다.</p>\n</li>\n<li>\n<p>6~10번 또한 같은 과정이지만 자원에 접근하고 난 후에 평가하는 과정이다.</p>\n</li>\n</ol>\n<h1 id=\"multiple-annotations\" style=\"position:relative;\"><a href=\"#multiple-annotations\" aria-label=\"multiple annotations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Multiple Annotations</h1>\n<p>자원에 접근하기 전, 접근한 후, 두 번에 걸쳐서 필터링을 걸 수 있기 때문에 서비스의 특정 메서드에 여러번 Annotation을 달 수 있다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('ADMIN')\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PostAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returnObject.name == 'user'\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Account</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>대신 같은 Annotation을 여러 번 달 수는 없다.</p>\n<h1 id=\"spel-표현식\" style=\"position:relative;\"><a href=\"#spel-%ED%91%9C%ED%98%84%EC%8B%9D\" aria-label=\"spel 표현식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>SpEL 표현식</h1>\n<p>Annotation을 쓸 때 여러 조건을 같이 걸 수 있다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@PreAuthorize(\"hasRole('USER') || hasAuthority('permission:db'))</code></pre></div>\n<p>위의 예시처럼 <code class=\"language-text\">USER</code>역할을 가진 사용자중 <code class=\"language-text\">permission:db</code>라는 권한을 가진 사람만 인가되도록 설정할 수 있다.</p>\n<h1 id=\"postauthorize\" style=\"position:relative;\"><a href=\"#postauthorize\" aria-label=\"postauthorize permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>@PostAuthorize</h1>\n<p><code class=\"language-text\">@PostAuthorize</code>를 사용하면 메서드가 반환하는 데이터에 대해 인가를 결정할 수 있다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@PostAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returnObject.createdDate &lt; 946684800000\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Account</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>946684800000은 2000년 1월 1일을 나타내는 값으로, 위와 같이 설정하면 생년월일이 2000년 1월 1일 이후인 사용자가 반환되려고 할 때 403에러가 던져지게 된다.</p>\n<h1 id=\"prefilter\" style=\"position:relative;\"><a href=\"#prefilter\" aria-label=\"prefilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>@PreFilter</h1>\n<p>인가뿐만 아니라 메서드 파라미터에 대해서도 필터링이 가능하다.</p>\n<p><code class=\"language-text\">@PreFilter</code>를 통해 파라미터에 대해 조건을 걸 수 있다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@PreFilter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"filterObject.birth_date > 946684800000\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Account</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">newAccounts</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Accounts</span><span class=\"token punctuation\">></span></span> accounts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>946684800000은 2000년 1월 1일을 나타내는 값으로, 위와 같이 설정하면 생년월일이 2000년 1월 1일 이후인 사용자만 생성되도록 설정할 수 있다.</p>\n<h1 id=\"postfilter\" style=\"position:relative;\"><a href=\"#postfilter\" aria-label=\"postfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>@PostFilter</h1>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@PostAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returnObject.createdDate &lt; 1704067200000\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Account</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>1704067200000은 2024년 1월 1일을 나타내는 값으로, 위와 같이 설정하면 결과값으로 반환되는 사용자들은 모두 2024년 1월 1일 이전에 생성된 사용자들이다.</p>\n<h1 id=\"class--interface-level-annotation\" style=\"position:relative;\"><a href=\"#class--interface-level-annotation\" aria-label=\"class  interface level annotation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Class / Interface level Annotation</h1>\n<p><code class=\"language-text\">@PreAuthorize</code>를 살펴보면 이렇다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">METHOD</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Inherited</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">PreAuthorize</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">/**\n\t * @return the Spring-EL expression to be evaluated before invoking the protected\n\t * method\n\t */</span>\n\t<span class=\"token class-name\">String</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">METHOD</code>와 <code class=\"language-text\">TYPE</code>이 명시되어 있다. 그러므로 클래스 또는 인터페이스 단위에서도 사용할 수 있다는 것이다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAuthority('permission:read')\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserService</span> userDetailsService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span> userDetailsService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userDetailsService <span class=\"token operator\">=</span> userDetailsService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Users</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> userDetailsService<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 코드처럼 <code class=\"language-text\">/users</code>로 접근하면 UserController에게 dispatch되는데 이때 <code class=\"language-text\">@PreAuthorize(\"hasAuthority('permission:read')\")</code>가 붙어있으므로 <code class=\"language-text\">permission:read</code> 권한을 가진 사용자만 UserController를 사용할 수(?) 있게 된다.</p>\n<p>또한 인터페이스에도 사용가능하다.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">METHOD</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('ADMIN')\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">IsAdmin</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 인터페이스를 정의하여 재사용가능하다.</p>","frontmatter":{"title":"24-1-31 Spring Security Method Authorization","date":"January 31, 2024","description":null,"tags":["TIL","spring"]},"tableOfContents":"<ul>\n<li><a href=\"#method-security\">Method Security</a></li>\n<li><a href=\"#flow\">Flow</a></li>\n<li><a href=\"#multiple-annotations\">Multiple Annotations</a></li>\n<li><a href=\"#spel-%ED%91%9C%ED%98%84%EC%8B%9D\">SpEL 표현식</a></li>\n<li><a href=\"#postauthorize\">@PostAuthorize</a></li>\n<li><a href=\"#prefilter\">@PreFilter</a></li>\n<li><a href=\"#postfilter\">@PostFilter</a></li>\n<li><a href=\"#class--interface-level-annotation\">Class / Interface level Annotation</a></li>\n</ul>"},"previous":{"fields":{"slug":"/til/24-1-26-Spring-Security-Authorization/"},"frontmatter":{"title":"24-1-26 Spring Security Authorization","date":"January 26, 2024"}},"next":{"fields":{"slug":"/til/24-2-14-Spring-Security-JWTAuthenticationFilter/"},"frontmatter":{"title":"24-2-14 Spring Security JWTAuthenticationFilter","date":"February 14, 2024"}}},"pageContext":{"id":"803ad70b-1e26-57db-88db-270519c661f4","previousPostId":"0d45699e-735f-5536-977e-e7d6e62bbad3","nextPostId":"38cfce23-4eb1-5002-88e8-bedc27c41d58"}},"staticQueryHashes":["1846574571","230163734","3589320610"],"slicesMap":{}}