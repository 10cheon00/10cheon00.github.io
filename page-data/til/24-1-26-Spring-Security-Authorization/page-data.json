{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/24-1-26-Spring-Security-Authorization/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"0d45699e-735f-5536-977e-e7d6e62bbad3","excerpt":"Spring Security 6.2.1을 사용했습니다. Authorization 직역하면 허가, 인증 그런 뜻이다. 자원에 대한 접근 권한을 Authority라고 하고, 사용자가 그 권한을 갖고 있는지 검사하는걸 Authorization이라고 한다. GrantedAuthority…","html":"<blockquote>\n<p>Spring Security 6.2.1을 사용했습니다.</p>\n</blockquote>\n<h1 id=\"authorization\" style=\"position:relative;\"><a href=\"#authorization\" aria-label=\"authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Authorization</h1>\n<p>직역하면 허가, 인증 그런 뜻이다. 자원에 대한 접근 권한을 Authority라고 하고, 사용자가 그 권한을 갖고 있는지 검사하는걸 Authorization이라고 한다.</p>\n<h2 id=\"grantedauthority\" style=\"position:relative;\"><a href=\"#grantedauthority\" aria-label=\"grantedauthority permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>GrantedAuthority</h2>\n<p>Authentication 과정에서 UserDetail에 담긴 정보가 전달된다. 여기에는 <code class=\"language-text\">GrantedAuthority</code>도 전달되는데, <em>부여된 권한</em>이라는 뜻의 인터페이스다.</p>\n<p><code class=\"language-text\">GrantedAuthority</code>를 살펴보면 이렇다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GrantedAuthority</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/*\n     * @return a representation of the granted authority (or &lt;code>null&lt;/code> if the\n     * granted authority cannot be expressed as a &lt;code>String&lt;/code> with sufficient\n     * precision).\n     */</span>\n    <span class=\"token class-name\">String</span> <span class=\"token function\">getAuthority</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>권한을 반환하는 메서드의 반환 타입이 String이다. Spring Security에서 권한을 다룰 때에는 단순히 권한 이름을 반환하는 <code class=\"language-text\">GrantedAuthority</code>를 사용한다.</p>\n<p><code class=\"language-text\">UserDetails</code> 인터페이스를 살펴보면 사용자의 권한을 어떻게 반환하는지 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/**\n     * Returns the authorities granted to the user. Cannot return &lt;code>null&lt;/code>.\n     * @return the authorities, sorted by natural key (never &lt;code>null&lt;/code>)\n     */</span>\n    <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>아까 말했던 <code class=\"language-text\">GrantedAuthority</code>가 Collection형태로 반환되고 있다. 인증 과정에서 이 메서드를 호출함으로 사용자에게 부여된 권한을 갖고 오게 된다.</p>\n<blockquote>\n<p><code class=\"language-text\">? extends GrantedAuthority</code>는 GrantedAuthority형 타입이 들어간다는 말이다.</p>\n</blockquote>\n<h2 id=\"authorizationmanager\" style=\"position:relative;\"><a href=\"#authorizationmanager\" aria-label=\"authorizationmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>AuthorizationManager</h2>\n<p>이전에는 AccessDecisionManager, AccessDecisionVoter라는 객체를 사용해서 인가 여부를 결정했던것 같다. 하지만 현재는 AuthorizationManager가 그 두 객체의 역할을 대체한다고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">AuthorizationDecision</span> <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Authentication</span><span class=\"token punctuation\">></span></span> authentication<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> secureObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">default</span> <span class=\"token class-name\">AuthorizationDecision</span> <span class=\"token function\">verify</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Authentication</span><span class=\"token punctuation\">></span></span> authentication<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> secureObject<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AccessDeniedException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>인증에 필요한 Authentication 객체 속에 <code class=\"language-text\">GrantedAuthority</code>가 들어있다. 이것은 <a href=\"https://docs.spring.io/spring-security/site/docs/6.2.1/api/org/springframework/security/core/Authentication.html\">Authentication</a> 인터페이스를 읽어보면 <code class=\"language-text\">getAuthorities()</code>가 명시되어있음으로 확인할 수 있다. AuthorizationManager는 <code class=\"language-text\">verify()</code>를 호출하여 정말 사용자가 권한을 갖고 있는지 검증한다.</p>\n<p>이 과정에서 <code class=\"language-text\">check()</code>를 호출하여 권한이 부여되었는지 검사한다. 권한이 부여되었다면 아무 에러도 일으키지 않고, 권한이 없다면 AccessDeniedException을 일으킨다.</p>\n<p>Spring Security는 기본적으로 특정 권한을 갖고 있는지 확인하는 <code class=\"language-text\">AuthorityAuthorizationManager</code>를 사용한다. 또는 다른 방식을 사용하는 객체를 사용해도 된다.</p>\n<h1 id=\"authorization-flow\" style=\"position:relative;\"><a href=\"#authorization-flow\" aria-label=\"authorization flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Authorization Flow</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5606a1b29e57f50799db9c9c1ed21dba/891d5/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVR42mOQl5fnYGBg4GRgYGCGYkYGBgYmDw8P9vr6/Sz1DAxM3Yt2clcuvzk7e8axrfnzzmwvWHSlJTIx175i+dU1eXPP7ihacGFL7syjWwsXnNvCIC4uriApLKwxL0A3foK3phfIUBUVFXao4WAw88wZ1o4tD8OqVlxOqV95PaN6zUOX+fNXSfSsv1zSuupCRceqi2Wty89UtK66VAxSzwQivpZYB34rs7UCse0hrmZhYPjPyMBQzwTBYADzAQNEDgu4UeU96Xy68bXDyUYHDyQaHr2ebXr1caGVF1hLPdwgMDAzU+GzslLnRTfjf/1/plWr/jODMMPF3sysW03hk85X+s0+VxUw43ZTeP/zGkdtBpW5oho2E3zUbCZ6aFpN8NKwnu6qbVkXq2XZEAliq1lM9NB2mOauZNbnLarVJQE1G+xqpv///zM+K7XNeFZo5wWzNT5zbrJP5OybATFzzwTEzD8dGDP/dEj8gtNBsfPO+EfPPecbNftcSPz8s27BM6+qmvXZgjWBfLQqNJR5prEx65Use55HhRacIHYoAwPz////wXj//noWTU0FeU0laVUTbWVZEP///1XMyJgBD2CEBDY4wJmQkhIo1lklJSW57O3tWRhIAUIMDHzS0kIyxsZacjAxUVFRHlFRUQk9ExMdXV0bQeTwwgEgSUDfqsVAWquhUFGvvkjZuKFYybg3XUanI1Fe3l5CUJBDTkJCXlNSUlJOREREUkZGhhOncaGhkHCISZuc7RU25WJIwuyDoQmzD4fEzz7l5D9pu7y6vYK0tKi+pKysjYyMjJmkpKSrlJSUMDaXAgA4pNP7XjsfYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/5606a1b29e57f50799db9c9c1ed21dba/f058b/image.png\"\n        srcset=\"/static/5606a1b29e57f50799db9c9c1ed21dba/c26ae/image.png 158w,\n/static/5606a1b29e57f50799db9c9c1ed21dba/6bdcf/image.png 315w,\n/static/5606a1b29e57f50799db9c9c1ed21dba/f058b/image.png 630w,\n/static/5606a1b29e57f50799db9c9c1ed21dba/40601/image.png 945w,\n/static/5606a1b29e57f50799db9c9c1ed21dba/78612/image.png 1260w,\n/static/5606a1b29e57f50799db9c9c1ed21dba/891d5/image.png 1520w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>사용자의 요청은 SecurityFilterChain을 통과하게 되고, 권한을 검사하는 필터인 AuthorizationFilter에 도달한다.</p>\n<ol>\n<li>\n<p>SecurityContextHolder로부터 인증 및 권한에 관한 정보가 담긴 <code class=\"language-text\">Authentication</code> 객체가 전달된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">Authentication</code>은 <code class=\"language-text\">HttpServletRequest</code>형태의 요청 객체와 함께 <code class=\"language-text\">RequestMatcherDelegatingAuthorizationManager</code>에게 전달되고, 권한을 갖고 있는지 검사한다. Manager객체는 Mapping된 URL 패턴 또는 HTTP Method 등 정해진 규칙에 따라 검사한다.</p>\n</li>\n<li>\n<p>검사 후 권한이 없다고 판별했다면 AccessDeniedException을 던진다. 이후 ExceptionTranslationFilter가 그 객체를 받아 처리한다.</p>\n</li>\n<li>\n<p>검사 후 권한이 있다고 판별했다면 계속 FilterChaining을 수행한다.</p>\n</li>\n</ol>\n<h2 id=\"filter-on-dispatch\" style=\"position:relative;\"><a href=\"#filter-on-dispatch\" aria-label=\"filter on dispatch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Filter on Dispatch</h2>\n<p>AuthorizationFilter는 사용자가 요청할 때마다 일어날 뿐만 아니라 Dispatch가 발생할 때에도 일어난다. Dispatcher는 <code class=\"language-text\">FORWARD</code>, <code class=\"language-text\">INCLUDE</code>, <code class=\"language-text\">REQUEST</code>, <code class=\"language-text\">ASYNC</code>, <code class=\"language-text\">ERROR</code> 총 5가지가 있다. 특정 엔드포인트로 이동하는 <code class=\"language-text\">FORWARD</code>, 에러가 발생했을 때를 의미하는 <code class=\"language-text\">ERROR</code>를 허용하면 된다.</p>\n<blockquote>\n<p>솔직히 어떤 의미인지 찾지 못했다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n    <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span>authorize <span class=\"token operator\">-></span> authorize\n        <span class=\"token punctuation\">.</span><span class=\"token function\">dispatcherTypeMatchers</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FORWARD</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"by-endpointmethoddispatchtype\" style=\"position:relative;\"><a href=\"#by-endpointmethoddispatchtype\" aria-label=\"by endpointmethoddispatchtype permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>By Endpoint/Method/DispatchType</h1>\n<p>사용자가 자원에 접근하려는걸 허가하려면 SecurityFilterChain을 반환하는 함수를 Bean으로 주입하여야 한다. 기본적으로는 모든 요청에 <code class=\"language-text\">authenticated</code>가 붙기 때문에 어떤 자원을 공개하기 위해서는 사용자가 재정의하여야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">web</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    http\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span>authorize <span class=\"token operator\">-></span> authorize                                  \n            <span class=\"token punctuation\">.</span><span class=\"token function\">dispatcherTypeMatchers</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FORWARD</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// &lt;-- 1</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/static/**\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/about\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// &lt;-- 2</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADMIN\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// &lt;-- 3</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/db/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token function\">allOf</span><span class=\"token punctuation\">(</span><span class=\"token function\">hasAuthority</span><span class=\"token punctuation\">(</span><span class=\"token char\">'db'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token char\">'ADMIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// &lt;-- 4</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">denyAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// &lt;-- 5</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>authorizeHttpRequests의 인자로 <strong>콜백함수</strong>를 넣는다. 이 콜백함수는 <strong>위에서부터 차례대로 matcher를 실행해 각 matcher가 명시한 조건에 해당하면 그 때 인가를 검증하는 방식</strong>으로 진행된다. 즉, 위의 예시에서는 1번부터 순서대로 5번까지 검증하게 된다. 만약 <code class=\"language-text\">/admin/users</code>와 같은 자원에 접근하면 3번에서 <code class=\"language-text\">/admin/**</code> 패턴에 의해 <em>ADMIN</em> 역할인지 검사하게 된다.</p>\n<ol>\n<li>\n<p><code class=\"language-text\">DispatchType</code>에 따라 결정한다. 여기선 <code class=\"language-text\">FORWARD</code>와 <code class=\"language-text\">ERROR</code> 타입의 dispatch들은 <code class=\"language-text\">permitAll()</code>을 함으로 Authorization을 안한다.</p>\n</li>\n<li>\n<p>특정 url 패턴을 대상으로 <code class=\"language-text\">permitAll()</code>을 한다. <code class=\"language-text\">/static/**</code>을 예시로 보면 <code class=\"language-text\">/static</code>, <code class=\"language-text\">/static/123</code>과 같은 패턴들은 모두 Authorization을 안한다.</p>\n</li>\n<li>\n<p>2번과 같지만 <code class=\"language-text\">hasRole(\"ADMIN\")</code>을 호출함으로, <em>ADMIN</em> 역할을 가진 사람들만 해당 자원을 허가하고 있다.</p>\n</li>\n<li>\n<p>3번과 비슷하지만, <code class=\"language-text\">hasAuthority('db')</code>와 <code class=\"language-text\">hasRole(\"ADMIN)</code>를 호출함으로 <em>ADMIN</em>역할이면서 <em>db</em>권한을 가진 사용자만 해당 자원에 접근할 수 있게 된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">anyRequest</code>는 모든 요청을 의미하므로, 결과적으로는 1, 2, ... 4까지 해당되는 패턴이나 조건 외에 나머지 요청들을 처리하게 된다. 여기선 <code class=\"language-text\">denyAll()</code>을 사용하여 사용자가 인증되었든말든 허가하지 않는다.</p>\n</li>\n</ol>\n<h1 id=\"role-authority\" style=\"position:relative;\"><a href=\"#role-authority\" aria-label=\"role authority permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Role? Authority?</h1>\n<p>위에서 4번 항목에 Role과 Authority가 등장한다. 역할과 권한인데, 이 둘의 차이점을 찾다가 <a href=\"https://stackoverflow.com/questions/19525380/difference-between-role-and-grantedauthority-in-spring-security/19542316#19542316\">다음과 같은 답변</a>을 발견했다.</p>\n<p>요약하자면 둘 다 같은 의미이고 둘 다 <code class=\"language-text\">GrantedAuthority</code>를 사용한다. 단지 Role은 접두사로 <code class=\"language-text\">ROLE_</code>을 붙여야 한다는 게 다르다.</p>\n<h1 id=\"role-계층\" style=\"position:relative;\"><a href=\"#role-%EA%B3%84%EC%B8%B5\" aria-label=\"role 계층 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Role 계층</h1>\n<p>이병 위에 일병, 일병 위에 상병이 있듯 역할간에도 상위 계층이 존재한다. 예를 들어 관리자는 읽기, 쓰기, 삭제가 되지만 일반 사용자는 읽기, 쓰기만 되는 것처럼 말이다.</p>\n<p>Spring Security에서는 계층을 나타내는 단순한 인터페이스인 <code class=\"language-text\">RoleHierarchy</code>가 있다. 그리고 이를 간단하게 구현한 <code class=\"language-text\">RoleHierarchyImpl</code>이 있다.</p>\n<p><code class=\"language-text\">RoleHierarchyImpl</code>을 통해 계층 관계를 명시하려면 특이하게도 문자열 형태로 작성해야한다. 예를 들어 <code class=\"language-text\">\"ROLE_PARENT > ROLE_CHILD\"</code>화살괄호를 사용하여 상위 역할을 표현하면 된다.</p>\n<p>만약 여러 계층을 나타내려면 <code class=\"language-text\">\\n</code>과 <code class=\"language-text\">+</code> 기호를 조합하여 나타내면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">RoleHierarchy</span> <span class=\"token function\">roleHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">RoleHierarchyImpl</span> hierarchy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleHierarchyImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    hierarchy<span class=\"token punctuation\">.</span><span class=\"token function\">setHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_ADMIN > ROLE_STAFF\\n\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"ROLE_STAFF > ROLE_USER\\n\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"ROLE_USER > ROLE_GUEST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> hierarchy<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>구현</h1>\n<p>먼저 SecurityConfig을 다음과 같이 수정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// SecurityConfig.java</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">web</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http\n                <span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractHttpConfigurer</span><span class=\"token operator\">::</span><span class=\"token function\">disable</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span>authorize <span class=\"token operator\">-></span> authorize\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">dispatcherTypeMatchers</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FORWARD</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/users/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasAuthority</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADMIN\"</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomUserDetailsService</span> <span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomUserDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">static</span> <span class=\"token class-name\">RoleHierarchy</span> <span class=\"token function\">roleHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// role간 계층을 정의한다.</span>\n        <span class=\"token class-name\">RoleHierarchyImpl</span> hierarchy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleHierarchyImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        hierarchy<span class=\"token punctuation\">.</span><span class=\"token function\">setHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_ADMIN > ROLE_USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> hierarchy<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">/login/**</code>으로 향하는 접근은 모두 허용, <code class=\"language-text\">/users/**</code>는 <em>ROLE_USER</em> 권한을 가진 사용자만 허용, <code class=\"language-text\">/admin/**</code>은 *ADMIN 역할을 가진 사용자만 허용, 그 외의 요청은 인증된 사용자만 허용하기로 했다.</p>\n<p>역할간에 계층을 설정해서 ADMIN이 USER보다 상위에 있도록 설정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Users.java</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Users</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> isEnabled<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@ManyToMany</span><span class=\"token punctuation\">(</span>fetch<span class=\"token operator\">=</span><span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EAGER</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinTable</span><span class=\"token punctuation\">(</span>\n            name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_roles\"</span><span class=\"token punctuation\">,</span>\n            joinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"users_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            inverseJoinColumns <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"roles_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Roles</span><span class=\"token punctuation\">></span></span> userRoles<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Roles</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>userRoles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Users에서는 <code class=\"language-text\">Collection&lt;? extends GrantedAuthority></code>를 반환하는 메서드에 ManyToMany로 정의된 userRoles를 반환하도록 작성했다. 왜 ManyToMany로 정의되었냐면, 한 사용자가 여러 권한 또는 여러 역할을 맡을 수 있기 때문이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Roles.java</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Roles</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">GrantedAuthority</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getAuthority</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>역할을 나타내는 Role은 <code class=\"language-text\">GrantedAuthority</code> 인터페이스를 구현하여 단순하게 문자열을 갖는 테이블이 되도록 구성했다.</p>\n<p>사용자가 로그인하지 않았다면 로그인 페이지로 이동하게 된다.</p>\n<p>로그인한 후 계정에 따라 <em>ROLE_ADMIN</em>권한이라면 <code class=\"language-text\">/admin</code>, <code class=\"language-text\">/users</code> 자원에 접근가능하고, <em>ROLE_USER</em>라면 <code class=\"language-text\">/users</code>에만 접근이 가능하다.</p>","frontmatter":{"title":"24-1-26 Spring Security Authorization","date":"January 26, 2024","description":null,"tags":["TIL","spring"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#authorization\">Authorization</a></p>\n<ul>\n<li><a href=\"#grantedauthority\">GrantedAuthority</a></li>\n<li><a href=\"#authorizationmanager\">AuthorizationManager</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#authorization-flow\">Authorization Flow</a></p>\n<ul>\n<li><a href=\"#filter-on-dispatch\">Filter on Dispatch</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#by-endpointmethoddispatchtype\">By Endpoint/Method/DispatchType</a></p>\n</li>\n<li>\n<p><a href=\"#role-authority\">Role? Authority?</a></p>\n</li>\n<li>\n<p><a href=\"#role-%EA%B3%84%EC%B8%B5\">Role 계층</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B5%AC%ED%98%84\">구현</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/til/24-1-22-docker-network/"},"frontmatter":{"title":"24-1-22 docker network","date":"January 22, 2024"}},"next":null},"pageContext":{"id":"0d45699e-735f-5536-977e-e7d6e62bbad3","previousPostId":"51b222f5-34e4-59ca-b3d5-4eedbc689b73","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}