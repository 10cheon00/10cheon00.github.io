{"componentChunkName":"component---src-templates-blog-post-js","path":"/design-patterns/플라이웨이트-패턴/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"ec145db0-8c23-5c03-92b0-d15dfa8260d5","excerpt":"의도 공유를 통해 다수의 작은 객체들을 지원한다. 수많은 객체가 하나의 클래스에 대해 각각의 인스턴스를 갖게 하기보다 미리 생성해놓은 인스턴스의 참조자를 가지도록 만드는 것이다. UML  사용자(Client)는 팩토리(FlyweightFactory)를 통해 플라이웨이트(Flyweight…","html":"<h1 id=\"의도\" style=\"position:relative;\"><a href=\"#%EC%9D%98%EB%8F%84\" aria-label=\"의도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>의도</h1>\n<p><strong>공유</strong>를 통해 다수의 작은 객체들을 지원한다. 수많은 객체가 하나의 클래스에 대해 각각의 인스턴스를 갖게 하기보다 미리 생성해놓은 인스턴스의 참조자를 가지도록 만드는 것이다.</p>\n<h1 id=\"uml\" style=\"position:relative;\"><a href=\"#uml\" aria-label=\"uml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>UML</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e125af5e13d66f3a1f8b3ca1166db2f0/8ae78/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVR42n2TZ4uCMRCE3///f/wi9oZdxAJiBbGLvbc5noXIeZ4GhoSU2dndiRcKhQSKxaK63a4SiYStV6uVlsul9vu9hsOh4vG4/H6/Go2G7U+nU83nc/0dXjabVaFQsIv9fl+3280O7ve7Ho+HzafTSdVqValUyoKVSiWbx+PxO+FsNtNisVCr1TJMJhPDer22IOfz2S7udjsDJKjn3J29EF6vV0srn89bWtFo1FCr1TQajUwdA7WOGNWfhkeU4/EoUq9UKup0Ok+yzWbzUgLGdru1PQK4IG+EoFwuKxwOmzqfz6dgMCjK4YjcYwi/KiQal+jc4XB4AtXUinNAUGaUUyLWl8tFlOxNoUvJATXuMjP2ICDNoxkAEcw0yZWA2fvdKZcWtaNJmUxGsVhMgUBA7XbbSPBfvV43v9JErESZKFcymfyfkFR5RKNyuZyRp9Np9Xo9Mzn24jFneBhCPgVvPiqk25gXUlSRMv6kURBHIhENBgMrA3vYqdlsyiMiGzTB1cLViuIDmuSMjXpE4E/AO+Ds5yGbL+f+LWCNSgjcniME38YPwpPTh7cP2dQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/e125af5e13d66f3a1f8b3ca1166db2f0/f058b/image.png\"\n        srcset=\"/static/e125af5e13d66f3a1f8b3ca1166db2f0/c26ae/image.png 158w,\n/static/e125af5e13d66f3a1f8b3ca1166db2f0/6bdcf/image.png 315w,\n/static/e125af5e13d66f3a1f8b3ca1166db2f0/f058b/image.png 630w,\n/static/e125af5e13d66f3a1f8b3ca1166db2f0/40601/image.png 945w,\n/static/e125af5e13d66f3a1f8b3ca1166db2f0/8ae78/image.png 1096w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>사용자(Client)는 팩토리(FlyweightFactory)를 통해 플라이웨이트(Flyweight) 객체를 생성한다.</p>\n<p>이 때 자료구조를 통해 이미 생성된 Flyweight 인스턴스를 반환하거나 새로 만들어 반환한다.</p>\n<p>Flyweight 추상 클래스에는 모든 플라이웨이트 객체가 가지는 행동을 정의한다.</p>\n<p>Fyweight 클래스의 서브 클래스들은 추상 클래스에 정의된 메서드를 구현한다.</p>\n<h1 id=\"사용-시기\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9-%EC%8B%9C%EA%B8%B0\" aria-label=\"사용 시기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>사용 시기</h1>\n<ul>\n<li>프로그램이 대량의 객체를 사용하여 저장 비용이 매우 높아질 때</li>\n<li>다수의 객체들이 비교적 적은 수의 <strong>공유된 객체</strong>로 대체될 수 있을 때. 살펴보니, 객체의 본질은 똑같지만 부가적인 속성만 달랐을 때</li>\n</ul>\n<h1 id=\"장점\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90\" aria-label=\"장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>장점</h1>\n<p>인스턴스를 공유함으로써 전체 개수를 줄일 수 있다. <strong>메모리 사용량을 줄이는 효과</strong>가 된다.</p>\n<h1 id=\"단점\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90\" aria-label=\"단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>단점</h1>\n<p>공유된 인스턴스를 이용하여 부가적인 상태에 대한 연산에 드는 비용이 생긴다.</p>\n<p>특정 인스턴스만 다르게 동작해야한다면 이 패턴을 적용할 수 없다.</p>\n<p>공유된 인스턴스를 수정하면 그 인스턴스를 참조하고 있는 객체에 영향을 끼친다.</p>\n<h1 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>구현</h1>\n<p>먼저 공유할 객체에서 본질적 속성만 남겨두고 부가적인 속성들은 제외시킨다.</p>\n<p>공유할 객체는 사용자가 생성할 수 없어야 하므로 팩토리를 통해 접근하도록 만든다.</p>\n<p>인벤토리에 목검이 100만개나 있다고 가정하자. 모든 목검은 외형이 같지만, 등급이라는 속성만 다르다고 하자.</p>\n<p>이 때 목검 인스턴스는 리소스(본질)와 등급(속성)을 갖는 객체라고 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">WoodSword</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\t\t<span class=\"token function\">WoodSword</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> tier<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token function\">_tier</span><span class=\"token punctuation\">(</span>tier<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">int</span> <span class=\"token function\">getTier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n\t\tSprite <span class=\"token operator\">*</span>_sprite<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> _tier<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>목검 스프라이트가 1Kb라고 가정하면 인벤토리에 들어있는 목검의 메모리 사용량은 100만Kb이다. 약 0.1Gb에 달한다.</p>\n<p>여기서 어차피 리소스가 똑같다면, 공유된 인스턴스로 만들어 메모리를 줄일 수 있다는게 플라이웨이트 패턴이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">WoodSwordFactory</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\t\t<span class=\"token keyword\">static</span> WoodSword<span class=\"token operator\">*</span> <span class=\"token function\">createWoodSword</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> tier<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_map<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>tier<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t_map<span class=\"token punctuation\">[</span>tier<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token function\">WoodSword</span><span class=\"token punctuation\">(</span>tier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token keyword\">return</span> _map<span class=\"token punctuation\">[</span>tier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n\t\tstd<span class=\"token double-colon punctuation\">::</span>Map<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> WoodSword<span class=\"token operator\">*</span><span class=\"token operator\">></span> _map<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">WoodSword</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n  <span class=\"token keyword\">int</span> <span class=\"token function\">getTier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> _tier<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">WoodSword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n    Sprite<span class=\"token operator\">*</span> _sprite<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> tier<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>공유된 인스턴스를 참조하기 위해 팩토리를 통해야만 목검을 참조할 수 있도록 되어있다.</p>\n<p>만약 생성된 적이 없는 목검이라면 새로 생성한 후 반환하도록 하고 있다. 반면 이미 생성되어있는 목검이라면 그 인스턴스를 바로 반환하도록 하고 있다.</p>\n<p>이렇게 할 경우 목검의 등급이 모두 같다면 새로운 인스턴스를 생성하지 않고 한 번 생성된 목검의 인스턴스를 참조하게 되므로 약 0.1Gb에서 1Kb에 가깝게 메모리 샤용량이 줄어들게 된다.</p>\n<p>만약 목검의 스프라이트가 바뀌었다면 팩토리에 등록되어있는 인스턴스 전체에게 영향이 갈 것이다. 이런 사이드 이펙트를 조심하기 위해서는 <strong>절대 변하지 않는 본질적 속성만 플라이웨이트 객체에 담아야 한다</strong>.</p>","frontmatter":{"title":"플라이웨이트 패턴","date":"July 28, 2023","description":null,"tags":["design-pattern"]}},"previous":{"fields":{"slug":"/design-patterns/퍼사드-패턴/"},"frontmatter":{"title":"퍼사드 패턴"}},"next":null},"pageContext":{"id":"ec145db0-8c23-5c03-92b0-d15dfa8260d5","previousPostId":"481c5b0f-198d-58f7-b5bf-41cfd838fcbf","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}