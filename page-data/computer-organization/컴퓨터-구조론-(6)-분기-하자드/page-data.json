{"componentChunkName":"component---src-templates-blog-post-js","path":"/computer-organization/컴퓨터-구조론-(6)-분기-하자드/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"ddfc56dc-d75d-5aae-be3b-126252b75a42","excerpt":"2023년 2학기 컴퓨터 구조론 수업을 듣고 정리한 내용입니다. 수업 교재는 컴퓨터 구조 및 설계 RISC-V…","html":"<blockquote>\n<p>2023년 2학기 컴퓨터 구조론 수업을 듣고 정리한 내용입니다. 수업 교재는 <a href=\"https://product.kyobobook.co.kr/detail/S000060622658\">컴퓨터 구조 및 설계 RISC-V 2판</a>입니다.</p>\n</blockquote>\n<h1 id=\"분기-하자드\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EA%B8%B0-%ED%95%98%EC%9E%90%EB%93%9C\" aria-label=\"분기 하자드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>분기 하자드</h1>\n<p>데이터 하자드와 유사하게, 분기 명령어를 실행할 때 발생한다.</p>\n<p>다음과 같은 명령어 코드를 파이프라인 데이터 패스에서 실행한다고 생각하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> 0  beq x10, x11,  12\n 4  add  x2,  x3,  x4 &lt;--\n...\n12   or x14, x28, x27\n16  add x12, x11, x10</code></pre></div>\n<p>파이프라인 데이터 패스에 의해 순차적으로 해독된 명령어는 각 단계에서 병렬적으로 실행된다. 그런데 <code class=\"language-text\">beq</code> 명령어는 분기 명령어로 두 레지스터가 같다면 현재 PC값에 상수를 더해 PC값을 변하게 만든다. 하지만 <strong>실제로 분기를 해야하는지 판단하는 단계는 MEM단계</strong>다.</p>\n<p>즉 MEM단계 이전에는 <strong>실행 여부가 불확실한 명령어</strong>를 인출, 해독하고 있다. 다시 말해 분기 명령어를 실행한다면 다음 명령어가 정확히 어떤 것인지 알 수 없다. 이것이 분기 하자드다.</p>\n<h1 id=\"분기-시-지연\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EA%B8%B0-%EC%8B%9C-%EC%A7%80%EC%97%B0\" aria-label=\"분기 시 지연 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>분기 시 지연</h1>\n<p>단순하게 분기 명령어 이후의 명령어가 어떤 것인지 결정되기 전까지 지연하는 방법이다. 분기가 확실한지 알기 위해서는 MEM단계까지 가야하므로, 3클럭 손실이 발생한다.</p>\n<p>MEM단계에서 분기를 예측하는 것보다 <em>ID단계</em>에서 레지스터에 접근하자마자 분기를 판단하는 방법을 사용한다면 1클럭 손실로 줄일 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/96c0bdd3b64cece7aee48c215027cb07/0d98f/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACoElEQVR42k2TC2/bNhRG9f//yVasWBZva9qmSdMGQRrbgLPWcVO/EsuxJOv9IiVSOhsZZ9sFiKtLiEeXut/noDVFnpOmKVVV0fc9SiniJKGsKnTXYcLs13VNYvbL0taNlMRxTNM0ZFlmGU7+Y0HpumilLKhtW7TWtu6Uouk6ZNdRtQqhNbX6L7+ssmls7roOJ/d96iShkA2VbIirmqAoWaQVfwUJflFSK41QmrbreQnVdXT9c60sWGMqp5CSRnc0h5cL0VAaqGhwS0FSVYha4MUpmWzRfY/uoZXC3sBEpzVSawzCycqSSkjbgfmSFDVn24KRV5DPpkRZxnS15o0nCaRCdD15q/iyjfDKGg1sgoggLyzcCZOEvKwI4oTt1uVuOmPihiwedkwGAwJ3i7dacXm3xg9DkiiyBz8tnnjKa/s822dssuoZGOc5ddPiRzGz6R1v/nzL5vGB1PeYnJzw+fh3bi8+cXt6ynA85n6xYLlccXb6gd0+tBBRVSRFgdIa5/HpiaPjAfPlisHxH/z80y+4G5cszwjjiLe/Dbh4/Sujd++5m31nF0acfvjI0dGA+cMjcRRZyaw2Lu52i5OWJV+/TQl8n5OT97x69RrXdfE8j+FwRLAPyT2f8c2Q6+svTL5NCaOYq6trvs6+4+12Vsd+FJFmGY48jL/vOtqm5fLzFfP5nPX6gdFojJSSoq45P78g2O/JlbbXvLkZcb9cW80aQYdpimwaHCNccRi7Ec5wPMH3fHzf/1f9Zp2ffWS5mONnOWmruLy65sdybeF5lhFl+TPQbDSqtfYxQNORcUtRFDarg4OKoiTPcjuI+7Ti1vV49HyyWlhYVJRIeQAKIayPX8JYyHRnoP9fxsdRGBKGEfsoIjr8t0oIhDHIPx3+DTzG0u9hoytfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/96c0bdd3b64cece7aee48c215027cb07/f058b/image.png\"\n        srcset=\"/static/96c0bdd3b64cece7aee48c215027cb07/c26ae/image.png 158w,\n/static/96c0bdd3b64cece7aee48c215027cb07/6bdcf/image.png 315w,\n/static/96c0bdd3b64cece7aee48c215027cb07/f058b/image.png 630w,\n/static/96c0bdd3b64cece7aee48c215027cb07/40601/image.png 945w,\n/static/96c0bdd3b64cece7aee48c215027cb07/78612/image.png 1260w,\n/static/96c0bdd3b64cece7aee48c215027cb07/0d98f/image.png 1276w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>별도의 분기 유닛을 두어 명령어 해독과 함께 분기를 판단한다. 만약 분기를 해야한다면, 현재 <em>IF단계에 인출된 명령어를 실행시키지 않기 위해</em> 그 명령어의 opcode를 0으로 만들어 아무런 행동을 하지 않도록 만든다.</p>\n<h1 id=\"분기-예측\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\" aria-label=\"분기 예측 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>분기 예측</h1>\n<p>지금은 5단계의 파이프라인 데이터 패스지만, 단계가 많아질수록 분기 손실이 매우 커진다. 그러므로 분기 여부를 예측, 단정짓고 진행하다가, 예측이 틀렸을 경우에만 rollback하여 진행한다. 이럴 경우에는 예측에 실패했을 때 손실이 생기며 좋은 알고리즘으로 이 손실을 최소화하여야 한다.</p>\n<h2 id=\"정적-분기-예측\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%A0%81-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\" aria-label=\"정적 분기 예측 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>정적 분기 예측</h2>\n<p>명령어를 해독할 때 얻은 정보로만 분기를 예측한다. 분기가 일어나지 않는다고 가정하면 분기 명령어 다음에 있는 명령어를 순차적으로 실행한다. 하지만 실제로 분기가 일어나야 한다면 <strong>처리하고 있던 명령어를 전부 쓸어내고</strong> 분기 목적지부터 실행을 재개한다.</p>\n<p>명령어들을 쓸어내기 위해서는 제어 신호를 모두 0으로 설정하는 방법이 있다. 이렇게 하면 어떤 처리를 하게 되더라도 실제로 레지스터나 메모리에 변화가 없게 된다.</p>\n<h2 id=\"동적-분기-예측\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%A0%81-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\" aria-label=\"동적 분기 예측 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>동적 분기 예측</h2>\n<p>프로그램을 실행하면서 별도의 상태를 설정하고, 분기 예측에 성공하거나 실패할 때마다 상태를 업데이트하여 동적으로 분기를 예측한다.</p>\n<h3 id=\"2비트-분기-예측\" style=\"position:relative;\"><a href=\"#2%EB%B9%84%ED%8A%B8-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\" aria-label=\"2비트 분기 예측 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>2비트 분기 예측</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 568px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8aa73ce4a9c7ec4e97eed535113d5ec4/10e91/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACR0lEQVR42n2T7U/TUBTG93cTAjL5AkwwI37ASIwfTEiMH4yGZKiwgUOIQTfn2OZece16t27dZO3a3nb9mRaGGMUnOffmnJt7Xp4nJxYAfhDg+D4h5NTHnwYEATcIgiCy3z5/Ibi2WOhYjo2qDzkrVGh2dIameefHGXzPx3I8TMfDld5NwVhLjHh+rPEo3WP9nSC53+XJkeCsphP4Ho7t0FFVukLgSYknXS70CSdNi0zNIl21+NCw+KqYUYHY00yblQOL1d02K6/rrLxp8CBjkdgTKL0+tuvSN4aR2a6DMC5JlUx2z8e8yNZ5+bHBq88au2WHkmoSq6lDnmU1Hr4XrKY01t8KHmcEJ5UejieZAoqmoRsGIcvS92n1bU4vnKjD/cqYbNMmr1iYtrziUErJYOwgfkr0S4ntuNcU31LhFqH2xKKn62j6EDGaoIWT2JMrDsNjbJr8uGhR+16h1ahjDAb/FWQymSBEF62j0esPEJrAsqyrhLlcjs3NTeLx+ywu3mNpKU4ikWAvlcJ1XRzHQVGUSJhwktA6qka5XKNQKJPPFymdV6nXWpimRWxra4u5uTkWFhaIx+PRPT8/z/LyMu1OB8fz6Pb7DEYjbCnRjRG5L9/IZk9JHxxxdHhM+uCQs0952m2VmBCCnZ0dkskka2trbGxssL29TbFYjAQJhRA9HWM0inzpTxkMjKijSrlGuVSlWm2gKp2o+4jDcLRwrEKhQLPZjDiabchdCN88z4uSTKfTm3hs9hAmnSnu+/6fq/aPZNwR+wU0KXXy1alBgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/8aa73ce4a9c7ec4e97eed535113d5ec4/10e91/image-1.png\"\n        srcset=\"/static/8aa73ce4a9c7ec4e97eed535113d5ec4/c26ae/image-1.png 158w,\n/static/8aa73ce4a9c7ec4e97eed535113d5ec4/6bdcf/image-1.png 315w,\n/static/8aa73ce4a9c7ec4e97eed535113d5ec4/10e91/image-1.png 568w\"\n        sizes=\"(max-width: 568px) 100vw, 568px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 상태도를 살펴보면 예측이 연속으로 두 번 틀렸을 때 다음 예측 방향을 바꾸게 된다. 두 번 틀릴 것을 한 번만 틀리게하는 방법으로 좋은 알고리즘의 예시다.</p>","frontmatter":{"title":"컴퓨터 구조론 (6) - 분기 하자드","date":"January 04, 2024","description":null,"tags":["computer-organization"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%B6%84%EA%B8%B0-%ED%95%98%EC%9E%90%EB%93%9C\">분기 하자드</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B6%84%EA%B8%B0-%EC%8B%9C-%EC%A7%80%EC%97%B0\">분기 시 지연</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\">분기 예측</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%A0%95%EC%A0%81-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\">정적 분기 예측</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8F%99%EC%A0%81-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\">동적 분기 예측</a></p>\n<ul>\n<li><a href=\"#2%EB%B9%84%ED%8A%B8-%EB%B6%84%EA%B8%B0-%EC%98%88%EC%B8%A1\">2비트 분기 예측</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/computer-organization/컴퓨터-구조론-(5)-데이터-하자드/"},"frontmatter":{"title":"컴퓨터 구조론 (5) - 데이터 하자드","date":"January 04, 2024"}},"next":{"fields":{"slug":"/computer-organization/컴퓨터-구조론-(7)-메모리-계층-및-캐시/"},"frontmatter":{"title":"컴퓨터 구조론 (7) - 메모리 계층 및 캐시","date":"January 04, 2024"}}},"pageContext":{"id":"ddfc56dc-d75d-5aae-be3b-126252b75a42","previousPostId":"d3a8d293-f147-5f81-9264-0c3495061037","nextPostId":"7a45ddae-547e-547a-ad37-f4183b0ed3f1"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}