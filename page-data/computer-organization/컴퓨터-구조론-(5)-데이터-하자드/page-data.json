{"componentChunkName":"component---src-templates-blog-post-js","path":"/computer-organization/컴퓨터-구조론-(5)-데이터-하자드/","result":{"data":{"site":{"siteMetadata":{"title":"10cheon00의 Archive"}},"markdownRemark":{"id":"d3a8d293-f147-5f81-9264-0c3495061037","excerpt":"2023년 2학기 컴퓨터 구조론 수업을 듣고 정리한 내용입니다. 수업 교재는 컴퓨터 구조 및 설계 RISC-V 2판입니다. 데이터 하자드 파이프라인 데이터 패스를 통해 다음 명령어를 실행해보자.  PC값은…","html":"<blockquote>\n<p>2023년 2학기 컴퓨터 구조론 수업을 듣고 정리한 내용입니다. 수업 교재는 <a href=\"https://product.kyobobook.co.kr/detail/S000060622658\">컴퓨터 구조 및 설계 RISC-V 2판</a>입니다.</p>\n</blockquote>\n<h1 id=\"데이터-하자드\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%95%98%EC%9E%90%EB%93%9C\" aria-label=\"데이터 하자드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>데이터 하자드</h1>\n<p>파이프라인 데이터 패스를 통해 다음 명령어를 실행해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> 0 add  x10, x11, x12\n 4 and  x13, x10, x14\n 8 or   x14, x13, x15\n12 slli x12, 100(x10)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 551px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df3e6601f78dc15607862c0f5c6971bf/db783/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABF0lEQVR42q2Ru07DQBBF/ceB/EQQFXREKA00pEigRaKgoKBEpEFWZNl5mMTGFo7wZh+zeyO/5a3ZZmdWM+femXWyLANjDM3hLEeSpG2uibDf72CMad9WgY/scGjzNEmQplWPI4kAGLwlhOdIlbEhQiwMJr4oi4SQ5T0JBHbcgAQvpDAPFd7Top8gpKqAVCs/rAVuPNGqBrnG4KNyrmtzRe796bZm9MUx21RiVNc4QlGpNt1KjP0OuGIaZ4s+8HxxhJd3wAuXYx5awO8ohvr9wZ2XY+zLziHTGHxaDi3gyOWY2UBJutxbMfKt5XBoORxawEuX49EGNsG/7bApfokUnsJu5OI3r5a8B7xecmyPHfB+LfAaqx7wBAIxYSgHsj7cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/df3e6601f78dc15607862c0f5c6971bf/db783/image.png\"\n        srcset=\"/static/df3e6601f78dc15607862c0f5c6971bf/c26ae/image.png 158w,\n/static/df3e6601f78dc15607862c0f5c6971bf/6bdcf/image.png 315w,\n/static/df3e6601f78dc15607862c0f5c6971bf/db783/image.png 551w\"\n        sizes=\"(max-width: 551px) 100vw, 551px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>PC값은 0번부터 초기화 되어있다. <code class=\"language-text\">add x10, x11, x12</code> 명령어가 인출된다. 인출된 명령어는 디코딩 단계로 진입한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 551px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e11e71a10ac42b4e5fa56b8d302837a6/db783/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEklEQVR42pWPMU8CQRCF+ccofwJjpYmFmlBRiAVoa2JhYWFJpNAgAY4TctxxRw5h2bmdnWfuluC2TjMzmfnem6nlea6UQhVa7dI0c7VlXi4jEXHtLJjmm42rszTNsnKtVjAD8pryU2wAEeaEpDUlAEQFgFZAkRYmDdjewrxlDDAVpoS50r4L6XqsnXCws/V+eYutXOt9Nd5aN2p+6u53qcjVqEaGAXs/L24qN7CZKXsy+INPB/vx7gCfDXVv4cFRkhbruD1RV19KftarJP5YbevvnrMHN4e668MFW0A6Id1OCBCInW5Nw3NuePD5UD/4sEud8mf6989u4zk2j5UkgEjLxUgf4cuRnu8PcDukl8Qc4V+1lsEjBQ2tAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/e11e71a10ac42b4e5fa56b8d302837a6/db783/image-1.png\"\n        srcset=\"/static/e11e71a10ac42b4e5fa56b8d302837a6/c26ae/image-1.png 158w,\n/static/e11e71a10ac42b4e5fa56b8d302837a6/6bdcf/image-1.png 315w,\n/static/e11e71a10ac42b4e5fa56b8d302837a6/db783/image-1.png 551w\"\n        sizes=\"(max-width: 551px) 100vw, 551px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>다음 클럭에는 ID단계에서 인출한 명령어가 있으므로 그 명령어를 해독하고 레지스터값을 읽어와 ALU에게 전달하게 된다. 그리고 현재 PC값은 4이므로 <code class=\"language-text\">and x13, x10, x14</code> 명령어가 인출된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 551px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/622b8c22e4052fc93b106eaddff8fa5c/db783/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABPklEQVR42p2RMU/DMBCF84dRgT9RxAQSQ1WpA2IAhhZWJAYGBsaKDqCqCm1aQpsqgZQ4sZ2zH7KdprRiwovvrHffe7a9NE2R5znWi+cMcZzUvSLCYjGH1ro+CyZjpKtV3SdxjCRxM54kAqDxGBPuotLWmghLodEZCysSQtq9MxGYcw0S3FihF5Z4Ssw8QcjSAalyvgwEWj6vXSdModF3yVUVzvR+pmpN85WjO3NmVGk8SU5wPZNoV4m0IgS5wv7AAbl0QweDAj7bAI+GHL1wB7hMPoHsC+c+w9kot3URLfASZ2g8M2CVIvyYQ7Jv7PXZFrA55OiGfyZUuJoKtN+EfUNohXFW4tAkVApk76xs/xt4POS42QWuCwNs+WLzk/99w7X4PipxW7mZZX7zZMS3gKcjjvdiA7yYCjwsyy3gD9PNYB4v8kyXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/622b8c22e4052fc93b106eaddff8fa5c/db783/image-2.png\"\n        srcset=\"/static/622b8c22e4052fc93b106eaddff8fa5c/c26ae/image-2.png 158w,\n/static/622b8c22e4052fc93b106eaddff8fa5c/6bdcf/image-2.png 315w,\n/static/622b8c22e4052fc93b106eaddff8fa5c/db783/image-2.png 551w\"\n        sizes=\"(max-width: 551px) 100vw, 551px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>다음 클럭에는 EX단계에서 ALU가 명령어를 처리한다. 버퍼에 저장된 레지스터를 연산한다. ID단계에는 직전에 인출된 명령어인 <code class=\"language-text\">and x13, x10, x14</code>를 해독하고 레지스터값을 읽어온다. 똑같이, 현재 PC값이 8이므로 <code class=\"language-text\">or  x14, x13, x15</code>가 인출된다.</p>\n<p>그런데, 명령어를 해독하다보니 <strong><code class=\"language-text\">x10</code> 레지스터</strong>를 읽어오고 있다. 직전 명령어를 살펴보면 <code class=\"language-text\">x11</code>과 <code class=\"language-text\">x12</code>에 저장된 데이터를 읽어온 후 <strong>두 값을 더하여 <code class=\"language-text\">x10</code>에 저장하고 있다</strong>.</p>\n<p>즉, ID단계에서 <code class=\"language-text\">x10</code>을 불러올 때에는 <strong>레지스터에 저장된 값이 이전 명령어의 결과값일 것임을 기대하고 있다</strong>. 하지만 <strong><em>아직 WB단계를 거치지 않았으므로 이전 명령어의 결과값이 불러와지지 않는다</em></strong>. 이것이 데이터 하자드다.</p>\n<p>데이터 하자드는 현재 실행되는 명령어가 직전 또는 직직전 명령어에 종속되어 현재 명령어를 실행하기 위해서는 종속된 명령어의 결과를 기다려야 함을 의미한다. CPU의 성능을 저하시키는 요인으로 작용한다.</p>\n<h1 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>해결 방법</h1>\n<ol>\n<li>지연시키기</li>\n<li><code class=\"language-text\">nop</code></li>\n<li>코드 재배열</li>\n<li>전방 전달 또는 우회</li>\n</ol>\n<h2 id=\"지연시키기\" style=\"position:relative;\"><a href=\"#%EC%A7%80%EC%97%B0%EC%8B%9C%ED%82%A4%EA%B8%B0\" aria-label=\"지연시키기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>지연시키기</h2>\n<p>종속된 명령어의 실행이 끝나기까지 강제로 파이프라인을 지연시키는 방법이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8851e27aad80227d6d699ef930cdf140/baaa6/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcRAAAXEQHKJvM/AAADJUlEQVR42k2Qy4vcBACH8wcUZA+6bvfesmC9WU+CoOhVRKgUFS1aUbDgybPixav46tNu1fVBodiiIriz3dqs++ruziOTZJJJJpNkMpN5JJnMazeTfLLbgx5+/L7v+glvXZeTM98Us9evlLI3rkrZe98p2fvfq9lrl0vZ24ty9tFNPTv7Pz53vZydvyFnH982sk/umNn5RTn7YEmdfvqHyzs3lJJwccVOv1h2+Hrl4a7ea3BxxearnMOlVZeldY8vc/YR/7je5NJdhyv3XH7ZbHJzq8XlVZdv77vprb2QS6uOJFSs3nQzb7Aj2ZjekGUxz593tzEaMZrTR7Vjqk4f3Y4o10I0O0JzIqRaiGQGVJ0IxQpT3ZugO5Ek1Jr9qWy2UK0OdntEUWtQrLhHrDsBRdXBaITY/hDTi7FaA+r+4Oj/4zhtRlPqrYEkNPxoqpkeNadNN9qnUK6yW6zQ6x9QtZr8s1XAaQb0eiOCcEK3O6QTjGgH46N1wjF+b5TGYw5dEgrVznSj5LCjeKjOgPVinW3ZQ3UHbEoOufUyeaNLobXPnU2VjXqE3BhRNAJKtZCyFVEyg1TzJpStUBIUqzfdURrkK030xoAdxaWg+1S9AfmKh7irI2tN9KVfWfvsc9RrP2MUa2iHja0emh2g2GFa8yeHbSWh0Y6mFcPFtFv0R1MqhoNp+/RHKYblsSXpNPfKsLBAdvIkHDtGvJxjzesgFmWCJKMbjNJxAr1oLAmaE04lw0epdai1hhQ0D6nqU/NHlKs+W2oDY1smW1ggnZ2F2VkOXjlDdOFD4jfP0Vv8Cbk9SRU7QPdiSdjT2xNx10w2ivVEsQeJuGcmm5L7kHeN5Le1UpJf3U04/XTCU6cTTj2ZMDOTMD+fMPNIEr57Ick9MPZv38qxV7QLQifaT912TCsY0x9nVEwP3WoxmEC3f0C9GTIcZ8QlDf33v+gqJrz0Mjz2KBwmeOIUPPNsynMvwPMvSoLjh3+rhisati82e0OxUK6K5YoltsOJaHvBkXfifdEOxuLaA0msThCTV8+KzD0upidOiNncnMj88fvp8blt5ud/+BcQIiV415O3FAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/8851e27aad80227d6d699ef930cdf140/f058b/image-3.png\"\n        srcset=\"/static/8851e27aad80227d6d699ef930cdf140/c26ae/image-3.png 158w,\n/static/8851e27aad80227d6d699ef930cdf140/6bdcf/image-3.png 315w,\n/static/8851e27aad80227d6d699ef930cdf140/f058b/image-3.png 630w,\n/static/8851e27aad80227d6d699ef930cdf140/baaa6/image-3.png 813w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>예시로 든 명령어는 and 명령어가 add 명령어에 종속되어 있기 때문에 add가 처리될 때까지 더이상 명령어 인출을 하지 않고 기다리게 된다.</p>\n<h2 id=\"nop\" style=\"position:relative;\"><a href=\"#nop\" aria-label=\"nop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>nop</h2>\n<p>명령어 인출을 하지 않는 방법이 약간은 복잡하기 때문에 단순히 소프트웨어단에서 아무것도 하지 않는 명령어를 넣는 방법이다.</p>\n<p>컴파일러가 명령어 코드를 생성한다면 이렇게 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> 0 add  x10, x11, x12\n 4 nop\n 8 nop\n12 and  x13, x10, x14\n16 or   x14, x13, x15\n   ...</code></pre></div>\n<h2 id=\"코드-재배열\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%9E%AC%EB%B0%B0%EC%97%B4\" aria-label=\"코드 재배열 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>코드 재배열</h2>\n<p>아무것도 하지 않는 명령어를 넣는다면, <em>종속성에 관련없는 명령어 코드</em>를 끼워 넣는 편이 더 낫다고 할 수 있다. 컴파일러에 따라 이런 테크닉이 가능하면 불필요한 실행 시간을 줄일 수 있다.</p>\n<h2 id=\"전방-전달-또는-우회\" style=\"position:relative;\"><a href=\"#%EC%A0%84%EB%B0%A9-%EC%A0%84%EB%8B%AC-%EB%98%90%EB%8A%94-%EC%9A%B0%ED%9A%8C\" aria-label=\"전방 전달 또는 우회 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>전방 전달 또는 우회</h2>\n<p><strong>종속된 명령어가 데이터를 필요로 할 때 곧바로 전달해주는 방법이다</strong>. 예시로 든 명령어를 살펴보면 EX단계에서 연산한 결과를 바로 ID단계의 버퍼로 전달시켜준다면 데이터 하자드를 회피할 수 있다.</p>\n<p>5개의 단계를 거치는 파이프라인 데이터 패스에서 전방전달을 해야할 때는 다음과 같다.</p>\n<ol>\n<li>연산 결과를 필요로 할 때 (EX)</li>\n<li>메모리의 데이터를 필요로 할 때 (MEM)</li>\n<li>레지스터에 쓴 데이터를 필요로 할 때 (WB)</li>\n</ol>\n<h3 id=\"ex-mem단계-포워딩\" style=\"position:relative;\"><a href=\"#ex-mem%EB%8B%A8%EA%B3%84-%ED%8F%AC%EC%9B%8C%EB%94%A9\" aria-label=\"ex mem단계 포워딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>EX, MEM단계 포워딩</h3>\n<p>연산 결과 또는 메모리 데이터를 전방 전달해야하는 경우다.</p>\n<p>만약 연산 결과를 전방 전달해야한다면 EX단계와 MEM단계 사이의 버퍼(EX/MEM)에 담긴 <code class=\"language-text\">rd</code>값을 필요로 하는지 확인해야하며 연산 결과가 종국엔 레지스터에 쓰여지는지 확인해야한다.</p>\n<p>또는 메모리 데이터를 전방 전달해야하는 경우라면 직전에 검사한 조건처럼 검사하되 EX/MEM 버퍼 대신 MEM/WB 버퍼를 확인해야한다.</p>\n<p>불필요한 전방 전달을 피하기 위해 rd값이 0인(읽기전용 레지스터인) 경우는 예외처리를 한다.</p>\n<p>레지스터에서 값을 읽어오는 대신 전방 전달을 하여 값을 갖고오는 것이므로 3가지의 입력이 들어가게 된다(레지스터, EX_MEM 버퍼, MEM_WB 버퍼). 따라서 멀티플렉서를 사용하여 입력을 받은 후 별도의 포워딩 유닛이 제어 신호를 생성하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a3fcd8673ac036ce688679aaf1636b86/5a6dd/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB1ElEQVR42nVT2ZKbMBDk/7/Mj36y17U2NgEMSCBOcRo61ZOIeHcrVE2hY6a755CHt28YBtxuN6zrKvtt2/a71+uF6/WKKIreQxCGIS6XC5Zlkb1XlqUA9X2PcRxRVZWsgyDA4/HAum1yTkDn811E13X73nOMDMjzHHVdy/p8PgvgPI4whZFA2jRN4u8UkcBa+w+QAJR8v9+FiUbnJM0QdhOi8YXW9vgVBDCmhDEGRVEIKcGomrYD8pIAvKRCpkySj8sFuTEYAHTWQislgSxR27biQ2U0B0gSUTjP815HOpPgcDjg9vkJXVYIo2gnbZpGVPLe930h4BmFnU4neO9FJgMvpaO+j6rtYKcZOi9EEdWnaSqZcBJc/SiGcf8BbLEuC4JMwe8mpMOf4jsAp4iZsN78k4jGtfd9DJIkke5K4dcV1bTIPLom8DyOY/Hjn4oJREKq/QLIQI7R8XhEHEXobI+0adFbi7au0NS1TMMzjgWYqWdZJmvX8R+AbBBBOdi27xGaCqGdEA0LVNMhDAJkSklNXfrEYPo/AN3HevCZlaWB0hpJNyLqZ+i6EeXP5xNKKUnbvTROgQC6eXJDzTVZ+Ua11si1lrRo3Ku/80ghNIK5TjP13+Cp5ThlU7fTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/a3fcd8673ac036ce688679aaf1636b86/f058b/image-4.png\"\n        srcset=\"/static/a3fcd8673ac036ce688679aaf1636b86/c26ae/image-4.png 158w,\n/static/a3fcd8673ac036ce688679aaf1636b86/6bdcf/image-4.png 315w,\n/static/a3fcd8673ac036ce688679aaf1636b86/f058b/image-4.png 630w,\n/static/a3fcd8673ac036ce688679aaf1636b86/5a6dd/image-4.png 802w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>만약 아래와 같은 명령어를 실행한다면 종속성이 두 개나 발견된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">add x2, x3, x4\nadd x2, x2, x5\nadd x6, x2, x7</code></pre></div>\n<p>3번째 명령어는 2번째 명령어의 rd와 1번째 명령어의 rd에게 종속성을 갖는다고 볼 수 있다. 이럴 때에는 가장 가까운 명령어에게 종속성을 갖도록 처리하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">EX_MEM</span><span class=\"token punctuation\">.</span>RegWrite <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">ID_EX</span><span class=\"token punctuation\">.</span>rs1 <span class=\"token operator\">==</span> <span class=\"token constant\">EX_MEM</span><span class=\"token punctuation\">.</span>rd <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">EX_MEM</span><span class=\"token punctuation\">.</span>rd <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// ALU 연산 결과를 필요로 할 때</span>\n  forwardA <span class=\"token operator\">=</span> <span class=\"token number\">00</span>\n<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">MEM_WB</span><span class=\"token punctuation\">.</span>RegWrite <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">ID_EX</span><span class=\"token punctuation\">.</span>rs1 <span class=\"token operator\">==</span> <span class=\"token constant\">MEM_WB</span><span class=\"token punctuation\">.</span>rd <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">MEM_WB</span><span class=\"token punctuation\">.</span>rd <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 메모리 데이터를 필요로 할 때</span>\n  forwardA <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n<span class=\"token comment\">// 위 두 가지가 아니면 레지스터를 읽기</span>\n<span class=\"token keyword\">else</span> forwardA <span class=\"token operator\">=</span> <span class=\"token number\">01</span></code></pre></div>\n<h3 id=\"wb단계\" style=\"position:relative;\"><a href=\"#wb%EB%8B%A8%EA%B3%84\" aria-label=\"wb단계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>WB단계</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lw  x10, 12(x11)\nadd x13, x10, x11</code></pre></div>\n<p>이런 명령어를 실행한다고 생각하자. <code class=\"language-text\">lw</code>는 레지스터에 쓰기 단계(WB)를 거치는 명령어인데, ALU 연산 결과는 접근할 데이터 메모리의 주소값이다. 그러므로 연산 결과를 전방 전달할 수 없고, 메모리에 접근을 해야만 전방 전달이 가능하다. <strong>따라서 한 단계를 강제로 지연시켜야 한다.</strong></p>\n<p>앞서 <code class=\"language-text\">RegWrite</code>를 검사했던 것처럼, <code class=\"language-text\">MemRead</code>인지 확인하고 그 때의 <code class=\"language-text\">rd</code>값이 <code class=\"language-text\">rs1</code> 또는 <code class=\"language-text\">rs2</code>와 같은지 확인해야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">ID_EX</span><span class=\"token punctuation\">.</span>MemRead <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token constant\">IF_ID</span><span class=\"token punctuation\">.</span>rs1 <span class=\"token operator\">==</span> <span class=\"token constant\">ID_EX</span><span class=\"token punctuation\">.</span>rd<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">IF_ID</span><span class=\"token punctuation\">.</span>rs2 <span class=\"token operator\">==</span> <span class=\"token constant\">ID_EX</span><span class=\"token punctuation\">.</span>rd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 읽어올 데이터 메모리에 종속성을 가질 때</span>\n    <span class=\"token comment\">// 지연시키기</span></code></pre></div>\n<p>지연시키는 방법은 컴파일러 대신 <strong>제어신호를 모두 0으로 만들어</strong> 아무것도 하지 않도록 만든다. PC값 또한 변하지 않도록 <strong>같은 명령어를 계속 인출하게 만든다</strong>. 이렇게 된다면 명령어를 인출하되 아무런 행동도 하지 않게된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/481584479d5bcbe6814d0c173d571221/416ee/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACN0lEQVR42oWS3Y6bMBBG8/5PtpdVd9WtkiWbEDAYB7AB8w+nGidbqe1FLY0wln3mm2/msO+w7TsbsK0rU1nRaMPadcja951xe8Qql/+zDv26MW8rk/cU0ZmL0nyrB6wuaHdwy0bez9z8hF+3R5K/IPszcQCOywrTSGMqylvKrBRNljENI/u64l2DrizateGhqFxE9TiwLMu/Cn1ZwTQxu4YiVfi2IbuXFNPGWDdEr2/8jBWXcaWeN+yyUYwz31VBUjtmIK1qcnN/AKt7Dd4zzDNJrhmHgco1dNPC3LSUl5hEG9w4Bo9F1bKD9gN2nAMkb3uUbZ4ld12of5lnCq3Jsoy6rnHO0XUdY+9pu462bYnjmM/Pz5DUdy3dOIWGzvOMfTbxoK0NAIkoivj4+KCqKsqyJM9zfN8HwP1+J9eay70mrx06z1HGBJj3nkuSorXmUBRFyKqU4mtvjAmK+r4Pl0WpKD9HEacoIisMtq7I72VQba3lkiThzmFd199ZRNn5fA5fWdv2GJNpmqjKElNbUttQOUfjHLFStO3DDlUYhmHg8DU/ApWyT6cTt9uNJEl4eXnheDyG8/h6JdUFbt0eYzP0pEURYK5pMHX9AH7NjwClNPFNIGLB+/s71+s1eCP7H2+vGNdg2g6VZ1xuN6ZxDFBR/wfwS6mULp7Iv5QslkhIkyRRqjXnbuJoKmKVUVobxsxYGzw//D3pcijNkbERsIQokDNpgFSQpimJUqg8Jy8MTedpn837BTrl4wVIacdUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Alt text\"\n        title=\"\"\n        src=\"/static/481584479d5bcbe6814d0c173d571221/f058b/image-5.png\"\n        srcset=\"/static/481584479d5bcbe6814d0c173d571221/c26ae/image-5.png 158w,\n/static/481584479d5bcbe6814d0c173d571221/6bdcf/image-5.png 315w,\n/static/481584479d5bcbe6814d0c173d571221/f058b/image-5.png 630w,\n/static/481584479d5bcbe6814d0c173d571221/416ee/image-5.png 930w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"컴퓨터 구조론 (5) - 데이터 하자드","date":"January 04, 2024","description":null,"tags":["computer-organization"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%95%98%EC%9E%90%EB%93%9C\">데이터 하자드</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">해결 방법</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%A7%80%EC%97%B0%EC%8B%9C%ED%82%A4%EA%B8%B0\">지연시키기</a></p>\n</li>\n<li>\n<p><a href=\"#nop\">nop</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%BD%94%EB%93%9C-%EC%9E%AC%EB%B0%B0%EC%97%B4\">코드 재배열</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%84%EB%B0%A9-%EC%A0%84%EB%8B%AC-%EB%98%90%EB%8A%94-%EC%9A%B0%ED%9A%8C\">전방 전달 또는 우회</a></p>\n<ul>\n<li><a href=\"#ex-mem%EB%8B%A8%EA%B3%84-%ED%8F%AC%EC%9B%8C%EB%94%A9\">EX, MEM단계 포워딩</a></li>\n<li><a href=\"#wb%EB%8B%A8%EA%B3%84\">WB단계</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/computer-organization/컴퓨터-구조론-(4)-데이터패스-(2)/"},"frontmatter":{"title":"컴퓨터 구조론 (4) - 데이터 패스 (2)"}},"next":null},"pageContext":{"id":"d3a8d293-f147-5f81-9264-0c3495061037","previousPostId":"1edba345-c60c-597f-8ad4-b0d576d0cb47","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}